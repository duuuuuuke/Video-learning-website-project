<!DOCTYPE html>
<html>
<head>
  <title>Email.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "src\\myapp\\system\\libraries\\Email.php";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>Email.php</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-meta">&lt;?php</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>CodeIgniter</p>
</div>
<div class="body">
<p>An open source application development framework for PHP</p>
<p>This content is released under the MIT License (MIT)</p>
<p>Copyright (c) 2014 - 2019, British Columbia Institute of Technology</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">defined(<span class="hljs-string">'BASEPATH'</span>) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">exit</span>(<span class="hljs-string">'No direct script access allowed'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>CodeIgniter Email Class</p>
</div>
<div class="body">
<p>Permits email to be sent using Mail, Sendmail, or SMTP.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CI_Email</span> </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Used as the User-Agent and X-Mailer headers' value.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $useragent	= <span class="hljs-string">'CodeIgniter'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Path to the Sendmail binary.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $mailpath	= <span class="hljs-string">'/usr/sbin/sendmail'</span>;	<span class="hljs-comment">// Sendmail path</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Which method to use for sending e-mails.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $protocol	= <span class="hljs-string">'mail'</span>;		<span class="hljs-comment">// mail/sendmail/smtp</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>STMP Server host</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_host	= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Username</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_user	= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Password</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_pass	= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Server port</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_port	= <span class="hljs-number">25</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP connection timeout in seconds</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_timeout	= <span class="hljs-number">5</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP persistent connection</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_keepalive	= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Encryption</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $smtp_crypto	= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to apply word-wrapping to the message body.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $wordwrap	= <span class="hljs-keyword">TRUE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<div class="dox">
<div class="summary">
<p>Number of characters to wrap at.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<span class="dox_type">CI_Email::$wordwrap</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $wrapchars	= <span class="hljs-number">76</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Message format.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $mailtype	= <span class="hljs-string">'text'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Character set (default: utf-8)</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $charset		= <span class="hljs-string">'UTF-8'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Alternative message (for HTML messages only)</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $alt_message	= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to validate e-mail addresses.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $validate	= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<div class="dox">
<div class="summary">
<p>X-Priority header value.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $priority	= <span class="hljs-number">3</span>;			<span class="hljs-comment">// Default priority (1 - 5)</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>Newline character sequence.
Use &quot;\r\n&quot; to comply with RFC 822.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $newline		= <span class="hljs-string">"\n"</span>;			<span class="hljs-comment">// Default newline. "\r\n" or "\n" (Use "\r\n" to comply with RFC 822)</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>CRLF character sequence</p>
</div>
<div class="body">
<p>RFC 2045 specifies that for 'quoted-printable' encoding,
&quot;\r\n&quot; must be used. However, it appears that some servers
(even on the receiving end) don't handle it properly and
switching to &quot;\n&quot;, while improper, is the only solution
that seems to work for all environments.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $crlf		= <span class="hljs-string">"\n"</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to use Delivery Status Notification.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $dsn		= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to send multipart alternatives.
Yahoo! doesn't seem to like these.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $send_multipart	= <span class="hljs-keyword">TRUE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to send messages to BCC recipients in batches.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $bcc_batch_mode	= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<div class="dox">
<div class="summary">
<p>BCC Batch max number size.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<span class="dox_type">CI_Email::$bcc_batch_mode</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $bcc_batch_size	= <span class="hljs-number">200</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether PHP is running in safe mode. Initialized by the class constructor.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_safe_mode		= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<div class="dox">
<div class="summary">
<p>Subject header</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_subject		= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<div class="dox">
<div class="summary">
<p>Message body</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_body		= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<div class="dox">
<div class="summary">
<p>Final message body to be sent.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_finalbody		= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<div class="dox">
<div class="summary">
<p>Final headers to send</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_header_str		= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Connection socket placeholder</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_smtp_connect	= <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Mail encoding</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_encoding		= <span class="hljs-string">'8bit'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to perform SMTP authentication</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_smtp_auth		= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<div class="dox">
<div class="summary">
<p>Whether to send a Reply-To header</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_replyto_flag	= <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<div class="dox">
<div class="summary">
<p>Debug messages</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<span class="dox_type">CI_Email::print_debugger()</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_debug_msg		= <span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<div class="dox">
<div class="summary">
<p>Recipients</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_recipients		= <span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<div class="dox">
<div class="summary">
<p>CC Recipients</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_cc_array		= <span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<div class="dox">
<div class="summary">
<p>BCC Recipients</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_bcc_array		= <span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<div class="dox">
<div class="summary">
<p>Message headers</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_headers		= <span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<div class="dox">
<div class="summary">
<p>Attachment data</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_attachments		= <span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<div class="dox">
<div class="summary">
<p>Valid $protocol values</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<span class="dox_type">CI_Email::$protocol</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_protocols		= <span class="hljs-keyword">array</span>(<span class="hljs-string">'mail'</span>, <span class="hljs-string">'sendmail'</span>, <span class="hljs-string">'smtp'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<div class="dox">
<div class="summary">
<p>Base charsets</p>
</div>
<div class="body">
<p>Character sets valid for 7-bit encoding,
excluding language suffix.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_base_charsets	= <span class="hljs-keyword">array</span>(<span class="hljs-string">'us-ascii'</span>, <span class="hljs-string">'iso-2022-'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<div class="dox">
<div class="summary">
<p>Bit depths</p>
</div>
<div class="body">
<p>Valid mail encodings</p>
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<span class="dox_type">CI_Email::$_encoding</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_bit_depths		= <span class="hljs-keyword">array</span>(<span class="hljs-string">'7bit'</span>, <span class="hljs-string">'8bit'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<div class="dox">
<div class="summary">
<p>$priority translations</p>
</div>
<div class="body">
<p>Actual values to send with the X-Priority header</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_priorities = <span class="hljs-keyword">array</span>(
		<span class="hljs-number">1</span> =&gt; <span class="hljs-string">'1 (Highest)'</span>,
		<span class="hljs-number">2</span> =&gt; <span class="hljs-string">'2 (High)'</span>,
		<span class="hljs-number">3</span> =&gt; <span class="hljs-string">'3 (Normal)'</span>,
		<span class="hljs-number">4</span> =&gt; <span class="hljs-string">'4 (Low)'</span>,
		<span class="hljs-number">5</span> =&gt; <span class="hljs-string">'5 (Lowest)'</span>
	);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<div class="dox">
<div class="summary">
<p>mbstring.func_overload flag</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> $func_overload;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<div class="dox">
<div class="summary">
<p>Constructor - Sets Email Preferences</p>
</div>
<div class="body">
<p>The constructor can be passed an array of config values</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$config = array()
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">(array $config = array<span class="hljs-params">()</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;charset = config_item(<span class="hljs-string">'charset'</span>);
		<span class="hljs-keyword">$this</span>-&gt;initialize($config);
		<span class="hljs-keyword">$this</span>-&gt;_safe_mode = ( ! is_php(<span class="hljs-string">'5.4'</span>) &amp;&amp; ini_get(<span class="hljs-string">'safe_mode'</span>));

		<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">self</span>::$func_overload) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">self</span>::$func_overload = (extension_loaded(<span class="hljs-string">'mbstring'</span>) &amp;&amp; ini_get(<span class="hljs-string">'mbstring.func_overload'</span>));

		log_message(<span class="hljs-string">'info'</span>, <span class="hljs-string">'Email Class Initialized'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<div class="dox">
<div class="summary">
<p>Initialize preferences</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$config
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span><span class="hljs-params">(array $config = array<span class="hljs-params">()</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;clear();

		<span class="hljs-keyword">foreach</span> ($config <span class="hljs-keyword">as</span> $key =&gt; $val)
		{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;$key))
			{
				$method = <span class="hljs-string">'set_'</span>.$key;

				<span class="hljs-keyword">if</span> (method_exists(<span class="hljs-keyword">$this</span>, $method))
				{
					<span class="hljs-keyword">$this</span>-&gt;$method($val);
				}
				<span class="hljs-keyword">else</span>
				{
					<span class="hljs-keyword">$this</span>-&gt;$key = $val;
				}
			}
		}

		<span class="hljs-keyword">$this</span>-&gt;charset = strtoupper(<span class="hljs-keyword">$this</span>-&gt;charset);
		<span class="hljs-keyword">$this</span>-&gt;_smtp_auth = <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;smtp_user[<span class="hljs-number">0</span>], <span class="hljs-keyword">$this</span>-&gt;smtp_pass[<span class="hljs-number">0</span>]);

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<div class="dox">
<div class="summary">
<p>Initialize the Email Data</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clear</span><span class="hljs-params">($clear_attachments = FALSE)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;_subject		= <span class="hljs-string">''</span>;
		<span class="hljs-keyword">$this</span>-&gt;_body		= <span class="hljs-string">''</span>;
		<span class="hljs-keyword">$this</span>-&gt;_finalbody	= <span class="hljs-string">''</span>;
		<span class="hljs-keyword">$this</span>-&gt;_header_str	= <span class="hljs-string">''</span>;
		<span class="hljs-keyword">$this</span>-&gt;_replyto_flag	= <span class="hljs-keyword">FALSE</span>;
		<span class="hljs-keyword">$this</span>-&gt;_recipients	= <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">$this</span>-&gt;_cc_array	= <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">$this</span>-&gt;_bcc_array	= <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">$this</span>-&gt;_headers		= <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">$this</span>-&gt;_debug_msg	= <span class="hljs-keyword">array</span>();

		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Date'</span>, <span class="hljs-keyword">$this</span>-&gt;_set_date());

		<span class="hljs-keyword">if</span> ($clear_attachments !== <span class="hljs-keyword">FALSE</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_attachments = <span class="hljs-keyword">array</span>();
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set FROM</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$from
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$name
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$return_path = NULL Return-Path
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">from</span><span class="hljs-params">($from, $name = <span class="hljs-string">''</span>, $return_path = NULL)</span>
	</span>{
		<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/\&lt;(.*)\&gt;/'</span>, $from, $match))
		{
			$from = $match[<span class="hljs-number">1</span>];
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;validate)
		{
			<span class="hljs-keyword">$this</span>-&gt;validate_email(<span class="hljs-keyword">$this</span>-&gt;_str_to_array($from));
			<span class="hljs-keyword">if</span> ($return_path)
			{
				<span class="hljs-keyword">$this</span>-&gt;validate_email(<span class="hljs-keyword">$this</span>-&gt;_str_to_array($return_path));
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>prepare the display name</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> ($name !== <span class="hljs-string">''</span>)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>only use Q encoding if there are characters that would require it</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> ( ! preg_match(<span class="hljs-string">'/[\200-\377]/'</span>, $name))
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>add slashes for non-printing characters, slashes, and double quotes, and surround it in double quotes</p>

        </td>
        <td class="code highlight">
          <pre class="php">				$name = <span class="hljs-string">'"'</span>.addcslashes($name, <span class="hljs-string">"\0..\37\177'\"\\"</span>).<span class="hljs-string">'"'</span>;
			}
			<span class="hljs-keyword">else</span>
			{
				$name = <span class="hljs-keyword">$this</span>-&gt;_prep_q_encoding($name);
			}
		}

		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'From'</span>, $name.<span class="hljs-string">' &lt;'</span>.$from.<span class="hljs-string">'&gt;'</span>);

		<span class="hljs-keyword">isset</span>($return_path) <span class="hljs-keyword">OR</span> $return_path = $from;
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Return-Path'</span>, <span class="hljs-string">'&lt;'</span>.$return_path.<span class="hljs-string">'&gt;'</span>);

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Reply-to</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reply_to</span><span class="hljs-params">($replyto, $name = <span class="hljs-string">''</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/\&lt;(.*)\&gt;/'</span>, $replyto, $match))
		{
			$replyto = $match[<span class="hljs-number">1</span>];
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;validate)
		{
			<span class="hljs-keyword">$this</span>-&gt;validate_email(<span class="hljs-keyword">$this</span>-&gt;_str_to_array($replyto));
		}

		<span class="hljs-keyword">if</span> ($name !== <span class="hljs-string">''</span>)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<p>only use Q encoding if there are characters that would require it</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> ( ! preg_match(<span class="hljs-string">'/[\200-\377]/'</span>, $name))
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<p>add slashes for non-printing characters, slashes, and double quotes, and surround it in double quotes</p>

        </td>
        <td class="code highlight">
          <pre class="php">				$name = <span class="hljs-string">'"'</span>.addcslashes($name, <span class="hljs-string">"\0..\37\177'\"\\"</span>).<span class="hljs-string">'"'</span>;
			}
			<span class="hljs-keyword">else</span>
			{
				$name = <span class="hljs-keyword">$this</span>-&gt;_prep_q_encoding($name);
			}
		}

		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Reply-To'</span>, $name.<span class="hljs-string">' &lt;'</span>.$replyto.<span class="hljs-string">'&gt;'</span>);
		<span class="hljs-keyword">$this</span>-&gt;_replyto_flag = <span class="hljs-keyword">TRUE</span>;

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Recipients</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">to</span><span class="hljs-params">($to)</span>
	</span>{
		$to = <span class="hljs-keyword">$this</span>-&gt;_str_to_array($to);
		$to = <span class="hljs-keyword">$this</span>-&gt;clean_email($to);

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;validate)
		{
			<span class="hljs-keyword">$this</span>-&gt;validate_email($to);
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() !== <span class="hljs-string">'mail'</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'To'</span>, implode(<span class="hljs-string">', '</span>, $to));
		}

		<span class="hljs-keyword">$this</span>-&gt;_recipients = $to;

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set CC</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cc</span><span class="hljs-params">($cc)</span>
	</span>{
		$cc = <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_str_to_array($cc));

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;validate)
		{
			<span class="hljs-keyword">$this</span>-&gt;validate_email($cc);
		}

		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Cc'</span>, implode(<span class="hljs-string">', '</span>, $cc));

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'smtp'</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_cc_array = $cc;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set BCC</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bcc</span><span class="hljs-params">($bcc, $limit = <span class="hljs-string">''</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> ($limit !== <span class="hljs-string">''</span> &amp;&amp; is_numeric($limit))
		{
			<span class="hljs-keyword">$this</span>-&gt;bcc_batch_mode = <span class="hljs-keyword">TRUE</span>;
			<span class="hljs-keyword">$this</span>-&gt;bcc_batch_size = $limit;
		}

		$bcc = <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_str_to_array($bcc));

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;validate)
		{
			<span class="hljs-keyword">$this</span>-&gt;validate_email($bcc);
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'smtp'</span> <span class="hljs-keyword">OR</span> (<span class="hljs-keyword">$this</span>-&gt;bcc_batch_mode &amp;&amp; count($bcc) &gt; <span class="hljs-keyword">$this</span>-&gt;bcc_batch_size))
		{
			<span class="hljs-keyword">$this</span>-&gt;_bcc_array = $bcc;
		}
		<span class="hljs-keyword">else</span>
		{
			<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Bcc'</span>, implode(<span class="hljs-string">', '</span>, $bcc));
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Email Subject</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subject</span><span class="hljs-params">($subject)</span>
	</span>{
		$subject = <span class="hljs-keyword">$this</span>-&gt;_prep_q_encoding($subject);
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Subject'</span>, $subject);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Body</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">message</span><span class="hljs-params">($body)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;_body = rtrim(str_replace(<span class="hljs-string">"\r"</span>, <span class="hljs-string">''</span>, $body));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<div class="dox">
<div class="summary">
<p>strip slashes only if magic quotes is ON
if we do it with magic quotes OFF, it strips real, user-inputted chars.</p>
</div>
<div class="body">
<p>NOTE: In PHP 5.4 get_magic_quotes_gpc() will always return 0 and
it will probably not exist in future versions at all.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> ( ! is_php(<span class="hljs-string">'5.4'</span>) &amp;&amp; get_magic_quotes_gpc())
		{
			<span class="hljs-keyword">$this</span>-&gt;_body = stripslashes(<span class="hljs-keyword">$this</span>-&gt;_body);
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<div class="dox">
<div class="summary">
<p>Assign file attachments</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$file Can be local path, URL or buffered content
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$disposition = 'attachment'
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$newname = NULL
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$mime = ''
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attach</span><span class="hljs-params">($file, $disposition = <span class="hljs-string">''</span>, $newname = NULL, $mime = <span class="hljs-string">''</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> ($mime === <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">if</span> (strpos($file, <span class="hljs-string">'://'</span>) === <span class="hljs-keyword">FALSE</span> &amp;&amp; ! file_exists($file))
			{
				<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_attachment_missing'</span>, $file);
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
			}

			<span class="hljs-keyword">if</span> ( ! $fp = @fopen($file, <span class="hljs-string">'rb'</span>))
			{
				<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_attachment_unreadable'</span>, $file);
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
			}

			$file_content = stream_get_contents($fp);
			$mime = <span class="hljs-keyword">$this</span>-&gt;_mime_types(pathinfo($file, PATHINFO_EXTENSION));
			fclose($fp);
		}
		<span class="hljs-keyword">else</span>
		{
			$file_content =&amp; $file; <span class="hljs-comment">// buffered file</span>
		}

		<span class="hljs-keyword">$this</span>-&gt;_attachments[] = <span class="hljs-keyword">array</span>(
			<span class="hljs-string">'name'</span>		=&gt; <span class="hljs-keyword">array</span>($file, $newname),
			<span class="hljs-string">'disposition'</span>	=&gt; <span class="hljs-keyword">empty</span>($disposition) ? <span class="hljs-string">'attachment'</span> : $disposition,  <span class="hljs-comment">// Can also be 'inline'  Not sure if it matters</span>
			<span class="hljs-string">'type'</span>		=&gt; $mime,
			<span class="hljs-string">'content'</span>	=&gt; chunk_split(base64_encode($file_content)),
			<span class="hljs-string">'multipart'</span>	=&gt; <span class="hljs-string">'mixed'</span>
		);

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set and return attachment Content-ID</p>
</div>
<div class="body">
<p>Useful for attached inline pictures</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$filename
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attachment_cid</span><span class="hljs-params">($filename)</span>
	</span>{
		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count(<span class="hljs-keyword">$this</span>-&gt;_attachments); $i &lt; $c; $i++)
		{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'name'</span>][<span class="hljs-number">0</span>] === $filename)
			{
				<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'multipart'</span>] = <span class="hljs-string">'related'</span>;
				<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'cid'</span>] = uniqid(basename(<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'name'</span>][<span class="hljs-number">0</span>]).<span class="hljs-string">'@'</span>);
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'cid'</span>];
			}
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<div class="dox">
<div class="summary">
<p>Add a Header Item</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_header</span><span class="hljs-params">($header, $value)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;_headers[$header] = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\n"</span>, <span class="hljs-string">"\r"</span>), <span class="hljs-string">''</span>, $value);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<div class="dox">
<div class="summary">
<p>Convert a String to an Array</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>array
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_str_to_array</span><span class="hljs-params">($email)</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! is_array($email))
		{
			<span class="hljs-keyword">return</span> (strpos($email, <span class="hljs-string">','</span>) !== <span class="hljs-keyword">FALSE</span>)
				? preg_split(<span class="hljs-string">'/[\s,]/'</span>, $email, <span class="hljs-number">-1</span>, PREG_SPLIT_NO_EMPTY)
				: (<span class="hljs-keyword">array</span>) trim($email);
		}

		<span class="hljs-keyword">return</span> $email;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Multipart Value</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_alt_message</span><span class="hljs-params">($str)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;alt_message = (string) $str;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Mailtype</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_mailtype</span><span class="hljs-params">($type = <span class="hljs-string">'text'</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;mailtype = ($type === <span class="hljs-string">'html'</span>) ? <span class="hljs-string">'html'</span> : <span class="hljs-string">'text'</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Wordwrap</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_wordwrap</span><span class="hljs-params">($wordwrap = TRUE)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;wordwrap = (bool) $wordwrap;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Protocol</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_protocol</span><span class="hljs-params">($protocol = <span class="hljs-string">'mail'</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;protocol = in_array($protocol, <span class="hljs-keyword">$this</span>-&gt;_protocols, <span class="hljs-keyword">TRUE</span>) ? strtolower($protocol) : <span class="hljs-string">'mail'</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Priority</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_priority</span><span class="hljs-params">($n = <span class="hljs-number">3</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;priority = preg_match(<span class="hljs-string">'/^[1-5]$/'</span>, $n) ? (int) $n : <span class="hljs-number">3</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Newline Character</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_newline</span><span class="hljs-params">($newline = <span class="hljs-string">"\n"</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;newline = in_array($newline, <span class="hljs-keyword">array</span>(<span class="hljs-string">"\n"</span>, <span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>)) ? $newline : <span class="hljs-string">"\n"</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set CRLF</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>CI_Email
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_crlf</span><span class="hljs-params">($crlf = <span class="hljs-string">"\n"</span>)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;crlf = ($crlf !== <span class="hljs-string">"\n"</span> &amp;&amp; $crlf !== <span class="hljs-string">"\r\n"</span> &amp;&amp; $crlf !== <span class="hljs-string">"\r"</span>) ? <span class="hljs-string">"\n"</span> : $crlf;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get the Message ID</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_message_id</span><span class="hljs-params">()</span>
	</span>{
		$from = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'&lt;'</span>), <span class="hljs-string">''</span>, <span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Return-Path'</span>]);
		<span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;'</span>.uniqid(<span class="hljs-string">''</span>).strstr($from, <span class="hljs-string">'@'</span>).<span class="hljs-string">'&gt;'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get Mail Protocol</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>mixed
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_protocol</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;protocol = strtolower(<span class="hljs-keyword">$this</span>-&gt;protocol);
		in_array(<span class="hljs-keyword">$this</span>-&gt;protocol, <span class="hljs-keyword">$this</span>-&gt;_protocols, <span class="hljs-keyword">TRUE</span>) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">$this</span>-&gt;protocol = <span class="hljs-string">'mail'</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;protocol;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get Mail Encoding</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_encoding</span><span class="hljs-params">()</span>
	</span>{
		in_array(<span class="hljs-keyword">$this</span>-&gt;_encoding, <span class="hljs-keyword">$this</span>-&gt;_bit_depths) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">$this</span>-&gt;_encoding = <span class="hljs-string">'8bit'</span>;

		<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_base_charsets <span class="hljs-keyword">as</span> $charset)
		{
			<span class="hljs-keyword">if</span> (strpos(<span class="hljs-keyword">$this</span>-&gt;charset, $charset) === <span class="hljs-number">0</span>)
			{
				<span class="hljs-keyword">$this</span>-&gt;_encoding = <span class="hljs-string">'7bit'</span>;
			}
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;_encoding;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get content type (text/html/attachment)</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_content_type</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;mailtype === <span class="hljs-string">'html'</span>)
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;_attachments) ? <span class="hljs-string">'html'</span> : <span class="hljs-string">'html-attach'</span>;
		}
		<span class="hljs-keyword">elseif</span>	(<span class="hljs-keyword">$this</span>-&gt;mailtype === <span class="hljs-string">'text'</span> &amp;&amp; ! <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;_attachments))
		{
			<span class="hljs-keyword">return</span> <span class="hljs-string">'plain-attach'</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-string">'plain'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set RFC 822 Date</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_set_date</span><span class="hljs-params">()</span>
	</span>{
		$timezone = date(<span class="hljs-string">'Z'</span>);
		$operator = ($timezone[<span class="hljs-number">0</span>] === <span class="hljs-string">'-'</span>) ? <span class="hljs-string">'-'</span> : <span class="hljs-string">'+'</span>;
		$timezone = abs($timezone);
		$timezone = floor($timezone/<span class="hljs-number">3600</span>) * <span class="hljs-number">100</span> + ($timezone % <span class="hljs-number">3600</span>) / <span class="hljs-number">60</span>;

		<span class="hljs-keyword">return</span> sprintf(<span class="hljs-string">'%s %s%04d'</span>, date(<span class="hljs-string">'D, j M Y H:i:s'</span>), $operator, $timezone);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-106" id="section-106"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-107" id="section-107"></a>
</div>
<div class="dox">
<div class="summary">
<p>Mime message</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_mime_message</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-string">'This is a multi-part message in MIME format.'</span>.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-string">'Your email application may not support this format.'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-108" id="section-108"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-109" id="section-109"></a>
</div>
<div class="dox">
<div class="summary">
<p>Validate Email Address</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate_email</span><span class="hljs-params">($email)</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! is_array($email))
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_must_be_array'</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">foreach</span> ($email <span class="hljs-keyword">as</span> $val)
		{
			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;valid_email($val))
			{
				<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_invalid_address'</span>, $val);
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
			}
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-110" id="section-110"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-111" id="section-111"></a>
</div>
<div class="dox">
<div class="summary">
<p>Email Validation</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">valid_email</span><span class="hljs-params">($email)</span>
	</span>{
		<span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">'idn_to_ascii'</span>) &amp;&amp; strpos($email, <span class="hljs-string">'@'</span>))
		{
			<span class="hljs-keyword">list</span>($account, $domain) = explode(<span class="hljs-string">'@'</span>, $email, <span class="hljs-number">2</span>);
			$domain = defined(<span class="hljs-string">'INTL_IDNA_VARIANT_UTS46'</span>)
				? idn_to_ascii($domain, <span class="hljs-number">0</span>, INTL_IDNA_VARIANT_UTS46)
				: idn_to_ascii($domain);

			<span class="hljs-keyword">if</span> ($domain !== <span class="hljs-keyword">FALSE</span>)
			{
				$email = $account.<span class="hljs-string">'@'</span>.$domain;
			}
		}

		<span class="hljs-keyword">return</span> (bool) filter_var($email, FILTER_VALIDATE_EMAIL);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-112" id="section-112"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-113" id="section-113"></a>
</div>
<div class="dox">
<div class="summary">
<p>Clean Extended Email Address: Joe Smith <a href="mailto:joe@smith.com.html">joe@smith.com</a></p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clean_email</span><span class="hljs-params">($email)</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! is_array($email))
		{
			<span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">'/\&lt;(.*)\&gt;/'</span>, $email, $match) ? $match[<span class="hljs-number">1</span>] : $email;
		}

		$clean_email = <span class="hljs-keyword">array</span>();

		<span class="hljs-keyword">foreach</span> ($email <span class="hljs-keyword">as</span> $addy)
		{
			$clean_email[] = preg_match(<span class="hljs-string">'/\&lt;(.*)\&gt;/'</span>, $addy, $match) ? $match[<span class="hljs-number">1</span>] : $addy;
		}

		<span class="hljs-keyword">return</span> $clean_email;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-114" id="section-114"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115"></a>
</div>
<div class="dox">
<div class="summary">
<p>Build alternative plain text message</p>
</div>
<div class="body">
<p>Provides the raw message for use in plain-text headers of
HTML-formatted emails.
If the user hasn't specified his own alternative message
it creates one by stripping the HTML</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_alt_message</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;alt_message))
		{
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">$this</span>-&gt;wordwrap)
				? <span class="hljs-keyword">$this</span>-&gt;word_wrap(<span class="hljs-keyword">$this</span>-&gt;alt_message, <span class="hljs-number">76</span>)
				: <span class="hljs-keyword">$this</span>-&gt;alt_message;
		}

		$body = preg_match(<span class="hljs-string">'/\&lt;body.*?\&gt;(.*)\&lt;\/body\&gt;/si'</span>, <span class="hljs-keyword">$this</span>-&gt;_body, $match) ? $match[<span class="hljs-number">1</span>] : <span class="hljs-keyword">$this</span>-&gt;_body;
		$body = str_replace(<span class="hljs-string">"\t"</span>, <span class="hljs-string">''</span>, preg_replace(<span class="hljs-string">'#&lt;!--(.*)--\&gt;#'</span>, <span class="hljs-string">''</span>, trim(strip_tags($body))));

		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">20</span>; $i &gt;= <span class="hljs-number">3</span>; $i--)
		{
			$body = str_replace(str_repeat(<span class="hljs-string">"\n"</span>, $i), <span class="hljs-string">"\n\n"</span>, $body);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-116" id="section-116"></a>
</div>
<p>Reduce multiple spaces</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$body = preg_replace(<span class="hljs-string">'| +|'</span>, <span class="hljs-string">' '</span>, $body);

		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">$this</span>-&gt;wordwrap)
			? <span class="hljs-keyword">$this</span>-&gt;word_wrap($body, <span class="hljs-number">76</span>)
			: $body;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-117" id="section-117"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-118" id="section-118"></a>
</div>
<div class="dox">
<div class="summary">
<p>Word Wrap</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
<span>line-length limit
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">word_wrap</span><span class="hljs-params">($str, $charlim = NULL)</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-119" id="section-119"></a>
</div>
<p>Set the character limit, if not already present</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($charlim))
		{
			$charlim = <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;wrapchars) ? <span class="hljs-number">76</span> : <span class="hljs-keyword">$this</span>-&gt;wrapchars;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-120" id="section-120"></a>
</div>
<p>Standardize newlines</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (strpos($str, <span class="hljs-string">"\r"</span>) !== <span class="hljs-keyword">FALSE</span>)
		{
			$str = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>), <span class="hljs-string">"\n"</span>, $str);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-121" id="section-121"></a>
</div>
<p>Reduce multiple spaces at end of line</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = preg_replace(<span class="hljs-string">'| +\n|'</span>, <span class="hljs-string">"\n"</span>, $str);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-122" id="section-122"></a>
</div>
<p>If the current word is surrounded by {unwrap} tags we'll
strip the entire chunk and replace it with a marker.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$unwrap = <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">if</span> (preg_match_all(<span class="hljs-string">'|\{unwrap\}(.+?)\{/unwrap\}|s'</span>, $str, $matches))
		{
			<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count($matches[<span class="hljs-number">0</span>]); $i &lt; $c; $i++)
			{
				$unwrap[] = $matches[<span class="hljs-number">1</span>][$i];
				$str = str_replace($matches[<span class="hljs-number">0</span>][$i], <span class="hljs-string">'{{unwrapped'</span>.$i.<span class="hljs-string">'}}'</span>, $str);
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-123" id="section-123"></a>
</div>
<p>Use PHP's native function to do the initial wordwrap.
We set the cut flag to FALSE so that any individual words that are
too long get left alone. In the next step we'll deal with them.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = wordwrap($str, $charlim, <span class="hljs-string">"\n"</span>, <span class="hljs-keyword">FALSE</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-124" id="section-124"></a>
</div>
<p>Split the string into individual lines of text and cycle through them</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$output = <span class="hljs-string">''</span>;
		<span class="hljs-keyword">foreach</span> (explode(<span class="hljs-string">"\n"</span>, $str) <span class="hljs-keyword">as</span> $line)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-125" id="section-125"></a>
</div>
<p>Is the line within the allowed character count?
If so we'll join it to the output and continue</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>::strlen($line) &lt;= $charlim)
			{
				$output .= $line.<span class="hljs-keyword">$this</span>-&gt;newline;
				<span class="hljs-keyword">continue</span>;
			}

			$temp = <span class="hljs-string">''</span>;
			<span class="hljs-keyword">do</span>
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-126" id="section-126"></a>
</div>
<p>If the over-length word is a URL we won't wrap it</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'!\[url.+\]|://|www\.!'</span>, $line))
				{
					<span class="hljs-keyword">break</span>;
				}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-127" id="section-127"></a>
</div>
<p>Trim the word down</p>

        </td>
        <td class="code highlight">
          <pre class="php">				$temp .= <span class="hljs-keyword">self</span>::substr($line, <span class="hljs-number">0</span>, $charlim - <span class="hljs-number">1</span>);
				$line = <span class="hljs-keyword">self</span>::substr($line, $charlim - <span class="hljs-number">1</span>);
			}
			<span class="hljs-keyword">while</span> (<span class="hljs-keyword">self</span>::strlen($line) &gt; $charlim);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-128" id="section-128"></a>
</div>
<p>If $temp contains data it means we had to split up an over-length
word into smaller chunks so we'll add it back to our current line</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> ($temp !== <span class="hljs-string">''</span>)
			{
				$output .= $temp.<span class="hljs-keyword">$this</span>-&gt;newline;
			}

			$output .= $line.<span class="hljs-keyword">$this</span>-&gt;newline;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-129" id="section-129"></a>
</div>
<p>Put our markers back</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (count($unwrap) &gt; <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">foreach</span> ($unwrap <span class="hljs-keyword">as</span> $key =&gt; $val)
			{
				$output = str_replace(<span class="hljs-string">'{{unwrapped'</span>.$key.<span class="hljs-string">'}}'</span>, $val, $output);
			}
		}

		<span class="hljs-keyword">return</span> $output;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-130" id="section-130"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-131" id="section-131"></a>
</div>
<div class="dox">
<div class="summary">
<p>Build final headers</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_build_headers</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-keyword">$this</span>-&gt;useragent);
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'X-Sender'</span>, <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'From'</span>]));
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'X-Mailer'</span>, <span class="hljs-keyword">$this</span>-&gt;useragent);
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'X-Priority'</span>, <span class="hljs-keyword">$this</span>-&gt;_priorities[<span class="hljs-keyword">$this</span>-&gt;priority]);
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Message-ID'</span>, <span class="hljs-keyword">$this</span>-&gt;_get_message_id());
		<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Mime-Version'</span>, <span class="hljs-string">'1.0'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-132" id="section-132"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-133" id="section-133"></a>
</div>
<div class="dox">
<div class="summary">
<p>Write Headers as a string</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_write_headers</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;protocol === <span class="hljs-string">'mail'</span>)
		{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Subject'</span>]))
			{
				<span class="hljs-keyword">$this</span>-&gt;_subject = <span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Subject'</span>];
				<span class="hljs-keyword">unset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Subject'</span>]);
			}
		}

		reset(<span class="hljs-keyword">$this</span>-&gt;_headers);
		<span class="hljs-keyword">$this</span>-&gt;_header_str = <span class="hljs-string">''</span>;

		<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_headers <span class="hljs-keyword">as</span> $key =&gt; $val)
		{
			$val = trim($val);

			<span class="hljs-keyword">if</span> ($val !== <span class="hljs-string">''</span>)
			{
				<span class="hljs-keyword">$this</span>-&gt;_header_str .= $key.<span class="hljs-string">': '</span>.$val.<span class="hljs-keyword">$this</span>-&gt;newline;
			}
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_header_str = rtrim(<span class="hljs-keyword">$this</span>-&gt;_header_str);
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-134" id="section-134"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-135" id="section-135"></a>
</div>
<div class="dox">
<div class="summary">
<p>Build Final Body and attachments</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_build_message</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;wordwrap === <span class="hljs-keyword">TRUE</span> &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;mailtype !== <span class="hljs-string">'html'</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_body = <span class="hljs-keyword">$this</span>-&gt;word_wrap(<span class="hljs-keyword">$this</span>-&gt;_body);
		}

		<span class="hljs-keyword">$this</span>-&gt;_write_headers();

		$hdr = (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>) ? <span class="hljs-keyword">$this</span>-&gt;newline : <span class="hljs-string">''</span>;
		$body = <span class="hljs-string">''</span>;

		<span class="hljs-keyword">switch</span> (<span class="hljs-keyword">$this</span>-&gt;_get_content_type())
		{
			<span class="hljs-keyword">case</span> <span class="hljs-string">'plain'</span>:

				$hdr .= <span class="hljs-string">'Content-Type: text/plain; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'Content-Transfer-Encoding: '</span>.<span class="hljs-keyword">$this</span>-&gt;_get_encoding();

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>)
				{
					<span class="hljs-keyword">$this</span>-&gt;_header_str .= $hdr;
					<span class="hljs-keyword">$this</span>-&gt;_finalbody = <span class="hljs-keyword">$this</span>-&gt;_body;
				}
				<span class="hljs-keyword">else</span>
				{
					<span class="hljs-keyword">$this</span>-&gt;_finalbody = $hdr.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;_body;
				}

				<span class="hljs-keyword">return</span>;

			<span class="hljs-keyword">case</span> <span class="hljs-string">'html'</span>:

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;send_multipart === <span class="hljs-keyword">FALSE</span>)
				{
					$hdr .= <span class="hljs-string">'Content-Type: text/html; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
						.<span class="hljs-string">'Content-Transfer-Encoding: quoted-printable'</span>;
				}
				<span class="hljs-keyword">else</span>
				{
					$boundary = uniqid(<span class="hljs-string">'B_ALT_'</span>);
					$hdr .= <span class="hljs-string">'Content-Type: multipart/alternative; boundary="'</span>.$boundary.<span class="hljs-string">'"'</span>;

					$body .= <span class="hljs-keyword">$this</span>-&gt;_get_mime_message().<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
						.<span class="hljs-string">'--'</span>.$boundary.<span class="hljs-keyword">$this</span>-&gt;newline

						.<span class="hljs-string">'Content-Type: text/plain; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
						.<span class="hljs-string">'Content-Transfer-Encoding: '</span>.<span class="hljs-keyword">$this</span>-&gt;_get_encoding().<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
						.<span class="hljs-keyword">$this</span>-&gt;_get_alt_message().<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
						.<span class="hljs-string">'--'</span>.$boundary.<span class="hljs-keyword">$this</span>-&gt;newline

						.<span class="hljs-string">'Content-Type: text/html; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
						.<span class="hljs-string">'Content-Transfer-Encoding: quoted-printable'</span>.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;
				}

				<span class="hljs-keyword">$this</span>-&gt;_finalbody = $body.<span class="hljs-keyword">$this</span>-&gt;_prep_quoted_printable(<span class="hljs-keyword">$this</span>-&gt;_body).<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>)
				{
					<span class="hljs-keyword">$this</span>-&gt;_header_str .= $hdr;
				}
				<span class="hljs-keyword">else</span>
				{
					<span class="hljs-keyword">$this</span>-&gt;_finalbody = $hdr.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;_finalbody;
				}

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;send_multipart !== <span class="hljs-keyword">FALSE</span>)
				{
					<span class="hljs-keyword">$this</span>-&gt;_finalbody .= <span class="hljs-string">'--'</span>.$boundary.<span class="hljs-string">'--'</span>;
				}

				<span class="hljs-keyword">return</span>;

			<span class="hljs-keyword">case</span> <span class="hljs-string">'plain-attach'</span>:

				$boundary = uniqid(<span class="hljs-string">'B_ATC_'</span>);
				$hdr .= <span class="hljs-string">'Content-Type: multipart/mixed; boundary="'</span>.$boundary.<span class="hljs-string">'"'</span>;

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>)
				{
					<span class="hljs-keyword">$this</span>-&gt;_header_str .= $hdr;
				}

				$body .= <span class="hljs-keyword">$this</span>-&gt;_get_mime_message().<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'--'</span>.$boundary.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'Content-Type: text/plain; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'Content-Transfer-Encoding: '</span>.<span class="hljs-keyword">$this</span>-&gt;_get_encoding().<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-keyword">$this</span>-&gt;_body.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;

				<span class="hljs-keyword">$this</span>-&gt;_append_attachments($body, $boundary);

				<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'html-attach'</span>:

				$alt_boundary = uniqid(<span class="hljs-string">'B_ALT_'</span>);
				$last_boundary = <span class="hljs-keyword">NULL</span>;

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_attachments_have_multipart(<span class="hljs-string">'mixed'</span>))
				{
					$atc_boundary = uniqid(<span class="hljs-string">'B_ATC_'</span>);
					$hdr .= <span class="hljs-string">'Content-Type: multipart/mixed; boundary="'</span>.$atc_boundary.<span class="hljs-string">'"'</span>;
					$last_boundary = $atc_boundary;
				}

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_attachments_have_multipart(<span class="hljs-string">'related'</span>))
				{
					$rel_boundary = uniqid(<span class="hljs-string">'B_REL_'</span>);
					$rel_boundary_header = <span class="hljs-string">'Content-Type: multipart/related; boundary="'</span>.$rel_boundary.<span class="hljs-string">'"'</span>;

					<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($last_boundary))
					{
						$body .= <span class="hljs-string">'--'</span>.$last_boundary.<span class="hljs-keyword">$this</span>-&gt;newline.$rel_boundary_header;
					}
					<span class="hljs-keyword">else</span>
					{
						$hdr .= $rel_boundary_header;
					}

					$last_boundary = $rel_boundary;
				}

				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>)
				{
					<span class="hljs-keyword">$this</span>-&gt;_header_str .= $hdr;
				}

				<span class="hljs-keyword">self</span>::strlen($body) &amp;&amp; $body .= <span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;
				$body .= <span class="hljs-keyword">$this</span>-&gt;_get_mime_message().<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'--'</span>.$last_boundary.<span class="hljs-keyword">$this</span>-&gt;newline

					.<span class="hljs-string">'Content-Type: multipart/alternative; boundary="'</span>.$alt_boundary.<span class="hljs-string">'"'</span>.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'--'</span>.$alt_boundary.<span class="hljs-keyword">$this</span>-&gt;newline

					.<span class="hljs-string">'Content-Type: text/plain; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'Content-Transfer-Encoding: '</span>.<span class="hljs-keyword">$this</span>-&gt;_get_encoding().<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-keyword">$this</span>-&gt;_get_alt_message().<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'--'</span>.$alt_boundary.<span class="hljs-keyword">$this</span>-&gt;newline

					.<span class="hljs-string">'Content-Type: text/html; charset='</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'Content-Transfer-Encoding: quoted-printable'</span>.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline

					.<span class="hljs-keyword">$this</span>-&gt;_prep_quoted_printable(<span class="hljs-keyword">$this</span>-&gt;_body).<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline
					.<span class="hljs-string">'--'</span>.$alt_boundary.<span class="hljs-string">'--'</span>.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;

				<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>($rel_boundary))
				{
					$body .= <span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;
					<span class="hljs-keyword">$this</span>-&gt;_append_attachments($body, $rel_boundary, <span class="hljs-string">'related'</span>);
				}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-136" id="section-136"></a>
</div>
<p>multipart/mixed attachments</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>($atc_boundary))
				{
					$body .= <span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline;
					<span class="hljs-keyword">$this</span>-&gt;_append_attachments($body, $atc_boundary, <span class="hljs-string">'mixed'</span>);
				}

				<span class="hljs-keyword">break</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;_finalbody = (<span class="hljs-keyword">$this</span>-&gt;_get_protocol() === <span class="hljs-string">'mail'</span>)
			? $body
			: $hdr.<span class="hljs-keyword">$this</span>-&gt;newline.<span class="hljs-keyword">$this</span>-&gt;newline.$body;

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-137" id="section-137"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_attachments_have_multipart</span><span class="hljs-params">($type)</span>
	</span>{
		<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_attachments <span class="hljs-keyword">as</span> &amp;$attachment)
		{
			<span class="hljs-keyword">if</span> ($attachment[<span class="hljs-string">'multipart'</span>] === $type)
			{
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
			}
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-138" id="section-138"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-139" id="section-139"></a>
</div>
<div class="dox">
<div class="summary">
<p>Prepares attachment string</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$body Message body to append to
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$boundary Multipart boundary
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$multipart When provided, only attachments of this type will be processed
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_append_attachments</span><span class="hljs-params">(&amp;$body, $boundary, $multipart = null)</span>
	</span>{
		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count(<span class="hljs-keyword">$this</span>-&gt;_attachments); $i &lt; $c; $i++)
		{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($multipart) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'multipart'</span>] !== $multipart)
			{
				<span class="hljs-keyword">continue</span>;
			}

			$name = <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'name'</span>][<span class="hljs-number">1</span>])
				? <span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'name'</span>][<span class="hljs-number">1</span>]
				: basename(<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'name'</span>][<span class="hljs-number">0</span>]);

			$body .= <span class="hljs-string">'--'</span>.$boundary.<span class="hljs-keyword">$this</span>-&gt;newline
				.<span class="hljs-string">'Content-Type: '</span>.<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'type'</span>].<span class="hljs-string">'; name="'</span>.$name.<span class="hljs-string">'"'</span>.<span class="hljs-keyword">$this</span>-&gt;newline
				.<span class="hljs-string">'Content-Disposition: '</span>.<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'disposition'</span>].<span class="hljs-string">';'</span>.<span class="hljs-keyword">$this</span>-&gt;newline
				.<span class="hljs-string">'Content-Transfer-Encoding: base64'</span>.<span class="hljs-keyword">$this</span>-&gt;newline
				.(<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'cid'</span>]) ? <span class="hljs-string">''</span> : <span class="hljs-string">'Content-ID: &lt;'</span>.<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'cid'</span>].<span class="hljs-string">'&gt;'</span>.<span class="hljs-keyword">$this</span>-&gt;newline)
				.<span class="hljs-keyword">$this</span>-&gt;newline
				.<span class="hljs-keyword">$this</span>-&gt;_attachments[$i][<span class="hljs-string">'content'</span>].<span class="hljs-keyword">$this</span>-&gt;newline;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-140" id="section-140"></a>
</div>
<p>$name won't be set if no attachments were appended,
and therefore a boundary wouldn't be necessary</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">empty</span>($name) <span class="hljs-keyword">OR</span> $body .= <span class="hljs-string">'--'</span>.$boundary.<span class="hljs-string">'--'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-141" id="section-141"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-142" id="section-142"></a>
</div>
<div class="dox">
<div class="summary">
<p>Prep Quoted Printable</p>
</div>
<div class="body">
<p>Prepares string for Quoted-Printable Content-Transfer-Encoding
Refer to RFC 2045 http://www.ietf.org/rfc/rfc2045.txt</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_prep_quoted_printable</span><span class="hljs-params">($str)</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-143" id="section-143"></a>
</div>
<p>ASCII code numbers for &quot;safe&quot; characters that can always be
used literally, without encoding, as described in RFC 2049.
http://www.ietf.org/rfc/rfc2049.txt</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">static</span> $ascii_safe_chars = <span class="hljs-keyword">array</span>(
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-144" id="section-144"></a>
</div>
<p>' (  )   +   ,   -   .   /   :   =   ?</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-number">39</span>, <span class="hljs-number">40</span>, <span class="hljs-number">41</span>, <span class="hljs-number">43</span>, <span class="hljs-number">44</span>, <span class="hljs-number">45</span>, <span class="hljs-number">46</span>, <span class="hljs-number">47</span>, <span class="hljs-number">58</span>, <span class="hljs-number">61</span>, <span class="hljs-number">63</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-145" id="section-145"></a>
</div>
<p>numbers</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-number">48</span>, <span class="hljs-number">49</span>, <span class="hljs-number">50</span>, <span class="hljs-number">51</span>, <span class="hljs-number">52</span>, <span class="hljs-number">53</span>, <span class="hljs-number">54</span>, <span class="hljs-number">55</span>, <span class="hljs-number">56</span>, <span class="hljs-number">57</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-146" id="section-146"></a>
</div>
<p>upper-case letters</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-number">65</span>, <span class="hljs-number">66</span>, <span class="hljs-number">67</span>, <span class="hljs-number">68</span>, <span class="hljs-number">69</span>, <span class="hljs-number">70</span>, <span class="hljs-number">71</span>, <span class="hljs-number">72</span>, <span class="hljs-number">73</span>, <span class="hljs-number">74</span>, <span class="hljs-number">75</span>, <span class="hljs-number">76</span>, <span class="hljs-number">77</span>, <span class="hljs-number">78</span>, <span class="hljs-number">79</span>, <span class="hljs-number">80</span>, <span class="hljs-number">81</span>, <span class="hljs-number">82</span>, <span class="hljs-number">83</span>, <span class="hljs-number">84</span>, <span class="hljs-number">85</span>, <span class="hljs-number">86</span>, <span class="hljs-number">87</span>, <span class="hljs-number">88</span>, <span class="hljs-number">89</span>, <span class="hljs-number">90</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-147" id="section-147"></a>
</div>
<p>lower-case letters</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-number">97</span>, <span class="hljs-number">98</span>, <span class="hljs-number">99</span>, <span class="hljs-number">100</span>, <span class="hljs-number">101</span>, <span class="hljs-number">102</span>, <span class="hljs-number">103</span>, <span class="hljs-number">104</span>, <span class="hljs-number">105</span>, <span class="hljs-number">106</span>, <span class="hljs-number">107</span>, <span class="hljs-number">108</span>, <span class="hljs-number">109</span>, <span class="hljs-number">110</span>, <span class="hljs-number">111</span>, <span class="hljs-number">112</span>, <span class="hljs-number">113</span>, <span class="hljs-number">114</span>, <span class="hljs-number">115</span>, <span class="hljs-number">116</span>, <span class="hljs-number">117</span>, <span class="hljs-number">118</span>, <span class="hljs-number">119</span>, <span class="hljs-number">120</span>, <span class="hljs-number">121</span>, <span class="hljs-number">122</span>
		);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-148" id="section-148"></a>
</div>
<p>We are intentionally wrapping so mail servers will encode characters
properly and MUAs will behave, so {unwrap} must go!</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">'{unwrap}'</span>, <span class="hljs-string">'{/unwrap}'</span>), <span class="hljs-string">''</span>, $str);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-149" id="section-149"></a>
</div>
<p>RFC 2045 specifies CRLF as &quot;\r\n&quot;.
However, many developers choose to override that and violate
the RFC rules due to (apparently) a bug in MS Exchange,
which only works with &quot;\n&quot;.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;crlf === <span class="hljs-string">"\r\n"</span>)
		{
			<span class="hljs-keyword">return</span> quoted_printable_encode($str);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-150" id="section-150"></a>
</div>
<p>Reduce multiple spaces &amp; remove nulls</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = preg_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">'| +|'</span>, <span class="hljs-string">'/\x00+/'</span>), <span class="hljs-keyword">array</span>(<span class="hljs-string">' '</span>, <span class="hljs-string">''</span>), $str);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-151" id="section-151"></a>
</div>
<p>Standardize newlines</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (strpos($str, <span class="hljs-string">"\r"</span>) !== <span class="hljs-keyword">FALSE</span>)
		{
			$str = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>), <span class="hljs-string">"\n"</span>, $str);
		}

		$escape = <span class="hljs-string">'='</span>;
		$output = <span class="hljs-string">''</span>;

		<span class="hljs-keyword">foreach</span> (explode(<span class="hljs-string">"\n"</span>, $str) <span class="hljs-keyword">as</span> $line)
		{
			$length = <span class="hljs-keyword">self</span>::strlen($line);
			$temp = <span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-152" id="section-152"></a>
</div>
<p>Loop through each character in the line to add soft-wrap
characters at the end of a line &quot; =\r\n&quot; and add the newly
processed line(s) to the output (see comment on $crlf class property)</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>; $i &lt; $length; $i++)
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-153" id="section-153"></a>
</div>
<p>Grab the next character</p>

        </td>
        <td class="code highlight">
          <pre class="php">				$char = $line[$i];
				$ascii = ord($char);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-154" id="section-154"></a>
</div>
<p>Convert spaces and tabs but only if it's the end of the line</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> ($ascii === <span class="hljs-number">32</span> <span class="hljs-keyword">OR</span> $ascii === <span class="hljs-number">9</span>)
				{
					<span class="hljs-keyword">if</span> ($i === ($length - <span class="hljs-number">1</span>))
					{
						$char = $escape.sprintf(<span class="hljs-string">'%02s'</span>, dechex($ascii));
					}
				}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-155" id="section-155"></a>
</div>
<p>DO NOT move this below the $ascii_safe_chars line!</p>
<p>= (equals) signs are allowed by RFC2049, but must be encoded
as they are the encoding delimiter!</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">elseif</span> ($ascii === <span class="hljs-number">61</span>)
				{
					$char = $escape.strtoupper(sprintf(<span class="hljs-string">'%02s'</span>, dechex($ascii)));  <span class="hljs-comment">// =3D</span>
				}
				<span class="hljs-keyword">elseif</span> ( ! in_array($ascii, $ascii_safe_chars, <span class="hljs-keyword">TRUE</span>))
				{
					$char = $escape.strtoupper(sprintf(<span class="hljs-string">'%02s'</span>, dechex($ascii)));
				}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-156" id="section-156"></a>
</div>
<p>If we're at the character limit, add the line to the output,
reset our temp variable, and keep on chuggin'</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> ((<span class="hljs-keyword">self</span>::strlen($temp) + <span class="hljs-keyword">self</span>::strlen($char)) &gt;= <span class="hljs-number">76</span>)
				{
					$output .= $temp.$escape.<span class="hljs-keyword">$this</span>-&gt;crlf;
					$temp = <span class="hljs-string">''</span>;
				}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-157" id="section-157"></a>
</div>
<p>Add the character to our temporary line</p>

        </td>
        <td class="code highlight">
          <pre class="php">				$temp .= $char;
			}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-158" id="section-158"></a>
</div>
<p>Add our completed line to the output</p>

        </td>
        <td class="code highlight">
          <pre class="php">			$output .= $temp.<span class="hljs-keyword">$this</span>-&gt;crlf;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-159" id="section-159"></a>
</div>
<p>get rid of extra CRLF tacked onto the end</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>::substr($output, <span class="hljs-number">0</span>, <span class="hljs-keyword">self</span>::strlen(<span class="hljs-keyword">$this</span>-&gt;crlf) * <span class="hljs-number">-1</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-160" id="section-160"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-161" id="section-161"></a>
</div>
<div class="dox">
<div class="summary">
<p>Prep Q Encoding</p>
</div>
<div class="body">
<p>Performs &quot;Q Encoding&quot; on a string for use in email headers.
It's related but not identical to quoted-printable, so it has its
own method.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_prep_q_encoding</span><span class="hljs-params">($str)</span>
	</span>{
		$str = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>), <span class="hljs-string">''</span>, $str);

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;charset === <span class="hljs-string">'UTF-8'</span>)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-162" id="section-162"></a>
</div>
<p>Note: We used to have mb_encode_mimeheader() as the first choice
here, but it turned out to be buggy and unreliable. DO NOT
re-add it! -- Narf</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> (ICONV_ENABLED === <span class="hljs-keyword">TRUE</span>)
			{
				$output = @iconv_mime_encode(<span class="hljs-string">''</span>, $str,
					<span class="hljs-keyword">array</span>(
						<span class="hljs-string">'scheme'</span> =&gt; <span class="hljs-string">'Q'</span>,
						<span class="hljs-string">'line-length'</span> =&gt; <span class="hljs-number">76</span>,
						<span class="hljs-string">'input-charset'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;charset,
						<span class="hljs-string">'output-charset'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;charset,
						<span class="hljs-string">'line-break-chars'</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;crlf
					)
				);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-163" id="section-163"></a>
</div>
<p>There are reports that iconv_mime_encode() might fail and return FALSE</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> ($output !== <span class="hljs-keyword">FALSE</span>)
				{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-164" id="section-164"></a>
</div>
<p>iconv_mime_encode() will always put a header field name.
We've passed it an empty one, but it still prepends our
encoded string with ': ', so we need to strip it.</p>

        </td>
        <td class="code highlight">
          <pre class="php">					<span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>::substr($output, <span class="hljs-number">2</span>);
				}

				$chars = iconv_strlen($str, <span class="hljs-string">'UTF-8'</span>);
			}
			<span class="hljs-keyword">elseif</span> (MB_ENABLED === <span class="hljs-keyword">TRUE</span>)
			{
				$chars = mb_strlen($str, <span class="hljs-string">'UTF-8'</span>);
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-165" id="section-165"></a>
</div>
<p>We might already have this set for UTF-8</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">isset</span>($chars) <span class="hljs-keyword">OR</span> $chars = <span class="hljs-keyword">self</span>::strlen($str);

		$output = <span class="hljs-string">'=?'</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-string">'?Q?'</span>;
		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $length = <span class="hljs-keyword">self</span>::strlen($output); $i &lt; $chars; $i++)
		{
			$chr = (<span class="hljs-keyword">$this</span>-&gt;charset === <span class="hljs-string">'UTF-8'</span> &amp;&amp; ICONV_ENABLED === <span class="hljs-keyword">TRUE</span>)
				? <span class="hljs-string">'='</span>.implode(<span class="hljs-string">'='</span>, str_split(strtoupper(bin2hex(iconv_substr($str, $i, <span class="hljs-number">1</span>, <span class="hljs-keyword">$this</span>-&gt;charset))), <span class="hljs-number">2</span>))
				: <span class="hljs-string">'='</span>.strtoupper(bin2hex($str[$i]));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-166" id="section-166"></a>
</div>
<p>RFC 2045 sets a limit of 76 characters per line.
We'll append ?= to the end of each line though.</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> ($length + ($l = <span class="hljs-keyword">self</span>::strlen($chr)) &gt; <span class="hljs-number">74</span>)
			{
				$output .= <span class="hljs-string">'?='</span>.<span class="hljs-keyword">$this</span>-&gt;crlf <span class="hljs-comment">// EOL</span>
					.<span class="hljs-string">' =?'</span>.<span class="hljs-keyword">$this</span>-&gt;charset.<span class="hljs-string">'?Q?'</span>.$chr; <span class="hljs-comment">// New line</span>
				$length = <span class="hljs-number">6</span> + <span class="hljs-keyword">self</span>::strlen(<span class="hljs-keyword">$this</span>-&gt;charset) + $l; <span class="hljs-comment">// Reset the length for the new line</span>
			}
			<span class="hljs-keyword">else</span>
			{
				$output .= $chr;
				$length += $l;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-167" id="section-167"></a>
</div>
<p>End the header</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">return</span> $output.<span class="hljs-string">'?='</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-168" id="section-168"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-169" id="section-169"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send Email</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
<span>$auto_clear = TRUE
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span><span class="hljs-params">($auto_clear = TRUE)</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'From'</span>]))
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_no_from'</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_replyto_flag === <span class="hljs-keyword">FALSE</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;reply_to(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'From'</span>]);
		}

		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_recipients) &amp;&amp; ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'To'</span>])
			&amp;&amp; ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_bcc_array) &amp;&amp; ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Bcc'</span>])
			&amp;&amp; ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Cc'</span>]))
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_no_recipients'</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;_build_headers();

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;bcc_batch_mode &amp;&amp; count(<span class="hljs-keyword">$this</span>-&gt;_bcc_array) &gt; <span class="hljs-keyword">$this</span>-&gt;bcc_batch_size)
		{
			$result = <span class="hljs-keyword">$this</span>-&gt;batch_bcc_send();

			<span class="hljs-keyword">if</span> ($result &amp;&amp; $auto_clear)
			{
				<span class="hljs-keyword">$this</span>-&gt;clear();
			}

			<span class="hljs-keyword">return</span> $result;
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_build_message() === <span class="hljs-keyword">FALSE</span>)
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		$result = <span class="hljs-keyword">$this</span>-&gt;_spool_email();

		<span class="hljs-keyword">if</span> ($result &amp;&amp; $auto_clear)
		{
			<span class="hljs-keyword">$this</span>-&gt;clear();
		}

		<span class="hljs-keyword">return</span> $result;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-170" id="section-170"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-171" id="section-171"></a>
</div>
<div class="dox">
<div class="summary">
<p>Batch Bcc Send. Sends groups of BCCs in batches</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">batch_bcc_send</span><span class="hljs-params">()</span>
	</span>{
		$float = <span class="hljs-keyword">$this</span>-&gt;bcc_batch_size - <span class="hljs-number">1</span>;
		$set = <span class="hljs-string">''</span>;
		$chunk = <span class="hljs-keyword">array</span>();

		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count(<span class="hljs-keyword">$this</span>-&gt;_bcc_array); $i &lt; $c; $i++)
		{
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;_bcc_array[$i]))
			{
				$set .= <span class="hljs-string">', '</span>.<span class="hljs-keyword">$this</span>-&gt;_bcc_array[$i];
			}

			<span class="hljs-keyword">if</span> ($i === $float)
			{
				$chunk[] = <span class="hljs-keyword">self</span>::substr($set, <span class="hljs-number">1</span>);
				$float += <span class="hljs-keyword">$this</span>-&gt;bcc_batch_size;
				$set = <span class="hljs-string">''</span>;
			}

			<span class="hljs-keyword">if</span> ($i === $c<span class="hljs-number">-1</span>)
			{
				$chunk[] = <span class="hljs-keyword">self</span>::substr($set, <span class="hljs-number">1</span>);
			}
		}

		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count($chunk); $i &lt; $c; $i++)
		{
			<span class="hljs-keyword">unset</span>(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Bcc'</span>]);

			$bcc = <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_str_to_array($chunk[$i]));

			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;protocol !== <span class="hljs-string">'smtp'</span>)
			{
				<span class="hljs-keyword">$this</span>-&gt;set_header(<span class="hljs-string">'Bcc'</span>, implode(<span class="hljs-string">', '</span>, $bcc));
			}
			<span class="hljs-keyword">else</span>
			{
				<span class="hljs-keyword">$this</span>-&gt;_bcc_array = $bcc;
			}

			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_build_message() === <span class="hljs-keyword">FALSE</span>)
			{
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
			}

			<span class="hljs-keyword">$this</span>-&gt;_spool_email();
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-172" id="section-172"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-173" id="section-173"></a>
</div>
<div class="dox">
<div class="summary">
<p>Unwrap special elements</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_unwrap_specials</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;_finalbody = preg_replace_callback(<span class="hljs-string">'/\{unwrap\}(.*?)\{\/unwrap\}/si'</span>, <span class="hljs-keyword">array</span>(<span class="hljs-keyword">$this</span>, <span class="hljs-string">'_remove_nl_callback'</span>), <span class="hljs-keyword">$this</span>-&gt;_finalbody);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-174" id="section-174"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-175" id="section-175"></a>
</div>
<div class="dox">
<div class="summary">
<p>Strip line-breaks via callback</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$matches
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_remove_nl_callback</span><span class="hljs-params">($matches)</span>
	</span>{
		<span class="hljs-keyword">if</span> (strpos($matches[<span class="hljs-number">1</span>], <span class="hljs-string">"\r"</span>) !== <span class="hljs-keyword">FALSE</span> <span class="hljs-keyword">OR</span> strpos($matches[<span class="hljs-number">1</span>], <span class="hljs-string">"\n"</span>) !== <span class="hljs-keyword">FALSE</span>)
		{
			$matches[<span class="hljs-number">1</span>] = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>), <span class="hljs-string">''</span>, $matches[<span class="hljs-number">1</span>]);
		}

		<span class="hljs-keyword">return</span> $matches[<span class="hljs-number">1</span>];
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-176" id="section-176"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-177" id="section-177"></a>
</div>
<div class="dox">
<div class="summary">
<p>Spool mail to the mail server</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_spool_email</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;_unwrap_specials();

		$protocol = <span class="hljs-keyword">$this</span>-&gt;_get_protocol();
		$method   = <span class="hljs-string">'_send_with_'</span>.$protocol;
		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;$method())
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_send_failure_'</span>.($protocol === <span class="hljs-string">'mail'</span> ? <span class="hljs-string">'phpmail'</span> : $protocol));
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_sent'</span>, $protocol);
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-178" id="section-178"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-179" id="section-179"></a>
</div>
<div class="dox">
<div class="summary">
<p>Validate email for shell</p>
</div>
<div class="body">
<p>Applies stricter, shell-safe validation to email addresses.
Introduced to prevent RCE via sendmail's -f option.</p>
</div>
<div class="details">
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<a href="https://github.com/bcit-ci/CodeIgniter/issues/4963">https://github.com/bcit-ci/CodeIgniter/issues/4963</a>
</div>
<div class="dox_tag_title">See</div>
<div class="dox_tag_detail">
<a href="https://gist.github.com/Zenexer/40d02da5e07f151adeaeeaa11af9ab36">https://gist.github.com/Zenexer/40d02da5e07f151adeaeeaa11af9ab36</a>
</div>
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$email
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_validate_email_for_shell</span><span class="hljs-params">(&amp;$email)</span>
	</span>{
		<span class="hljs-keyword">if</span> (function_exists(<span class="hljs-string">'idn_to_ascii'</span>) &amp;&amp; strpos($email, <span class="hljs-string">'@'</span>))
		{
			<span class="hljs-keyword">list</span>($account, $domain) = explode(<span class="hljs-string">'@'</span>, $email, <span class="hljs-number">2</span>);
			$domain = defined(<span class="hljs-string">'INTL_IDNA_VARIANT_UTS46'</span>)
				? idn_to_ascii($domain, <span class="hljs-number">0</span>, INTL_IDNA_VARIANT_UTS46)
				: idn_to_ascii($domain);

			<span class="hljs-keyword">if</span> ($domain !== <span class="hljs-keyword">FALSE</span>)
			{
				$email = $account.<span class="hljs-string">'@'</span>.$domain;
			}
		}

		<span class="hljs-keyword">return</span> (filter_var($email, FILTER_VALIDATE_EMAIL) === $email &amp;&amp; preg_match(<span class="hljs-string">'#\A[a-z0-9._+-]+@[a-z0-9.-]{1,253}\z#i'</span>, $email));
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-180" id="section-180"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-181" id="section-181"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send using mail()</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_send_with_mail</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (is_array(<span class="hljs-keyword">$this</span>-&gt;_recipients))
		{
			<span class="hljs-keyword">$this</span>-&gt;_recipients = implode(<span class="hljs-string">', '</span>, <span class="hljs-keyword">$this</span>-&gt;_recipients);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-182" id="section-182"></a>
</div>
<p>_validate_email_for_shell() below accepts by reference,
so this needs to be assigned to a variable</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$from = <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'Return-Path'</span>]);

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_safe_mode === <span class="hljs-keyword">TRUE</span> || ! <span class="hljs-keyword">$this</span>-&gt;_validate_email_for_shell($from))
		{
			<span class="hljs-keyword">return</span> mail(<span class="hljs-keyword">$this</span>-&gt;_recipients, <span class="hljs-keyword">$this</span>-&gt;_subject, <span class="hljs-keyword">$this</span>-&gt;_finalbody, <span class="hljs-keyword">$this</span>-&gt;_header_str);
		}
		<span class="hljs-keyword">else</span>
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-183" id="section-183"></a>
</div>
<p>most documentation of sendmail using the &quot;-f&quot; flag lacks a space after it, however
we've encountered servers that seem to require it to be in place.</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">return</span> mail(<span class="hljs-keyword">$this</span>-&gt;_recipients, <span class="hljs-keyword">$this</span>-&gt;_subject, <span class="hljs-keyword">$this</span>-&gt;_finalbody, <span class="hljs-keyword">$this</span>-&gt;_header_str, <span class="hljs-string">'-f '</span>.$from);
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-184" id="section-184"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-185" id="section-185"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send using Sendmail</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_send_with_sendmail</span><span class="hljs-params">()</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-186" id="section-186"></a>
</div>
<p>_validate_email_for_shell() below accepts by reference,
so this needs to be assigned to a variable</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$from = <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'From'</span>]);
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_validate_email_for_shell($from))
		{
			$from = <span class="hljs-string">'-f '</span>.$from;
		}
		<span class="hljs-keyword">else</span>
		{
			$from = <span class="hljs-string">''</span>;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-187" id="section-187"></a>
</div>
<p>is popen() enabled?</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> ( ! function_usable(<span class="hljs-string">'popen'</span>)	<span class="hljs-keyword">OR</span> <span class="hljs-keyword">FALSE</span> === ($fp = @popen(<span class="hljs-keyword">$this</span>-&gt;mailpath.<span class="hljs-string">' -oi '</span>.$from.<span class="hljs-string">' -t'</span>, <span class="hljs-string">'w'</span>)))
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-188" id="section-188"></a>
</div>
<p>server probably has popen disabled, so nothing we can do to get a verbose error.</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		fputs($fp, <span class="hljs-keyword">$this</span>-&gt;_header_str);
		fputs($fp, <span class="hljs-keyword">$this</span>-&gt;_finalbody);

		$status = pclose($fp);

		<span class="hljs-keyword">if</span> ($status !== <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_exit_status'</span>, $status);
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_no_socket'</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-189" id="section-189"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-190" id="section-190"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send using SMTP</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_send_with_smtp</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;smtp_host === <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_no_hostname'</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;_smtp_connect() <span class="hljs-keyword">OR</span> ! <span class="hljs-keyword">$this</span>-&gt;_smtp_authenticate())
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'from'</span>, <span class="hljs-keyword">$this</span>-&gt;clean_email(<span class="hljs-keyword">$this</span>-&gt;_headers[<span class="hljs-string">'From'</span>])))
		{
			<span class="hljs-keyword">$this</span>-&gt;_smtp_end();
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_recipients <span class="hljs-keyword">as</span> $val)
		{
			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'to'</span>, $val))
			{
				<span class="hljs-keyword">$this</span>-&gt;_smtp_end();
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
			}
		}

		<span class="hljs-keyword">if</span> (count(<span class="hljs-keyword">$this</span>-&gt;_cc_array) &gt; <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_cc_array <span class="hljs-keyword">as</span> $val)
			{
				<span class="hljs-keyword">if</span> ($val !== <span class="hljs-string">''</span> &amp;&amp; ! <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'to'</span>, $val))
				{
					<span class="hljs-keyword">$this</span>-&gt;_smtp_end();
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
				}
			}
		}

		<span class="hljs-keyword">if</span> (count(<span class="hljs-keyword">$this</span>-&gt;_bcc_array) &gt; <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_bcc_array <span class="hljs-keyword">as</span> $val)
			{
				<span class="hljs-keyword">if</span> ($val !== <span class="hljs-string">''</span> &amp;&amp; ! <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'to'</span>, $val))
				{
					<span class="hljs-keyword">$this</span>-&gt;_smtp_end();
					<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
				}
			}
		}

		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'data'</span>))
		{
			<span class="hljs-keyword">$this</span>-&gt;_smtp_end();
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-191" id="section-191"></a>
</div>
<p>perform dot transformation on any lines that begin with a dot</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-keyword">$this</span>-&gt;_header_str.preg_replace(<span class="hljs-string">'/^\./m'</span>, <span class="hljs-string">'..$1'</span>, <span class="hljs-keyword">$this</span>-&gt;_finalbody));

		<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'.'</span>);

		$reply = <span class="hljs-keyword">$this</span>-&gt;_get_smtp_data();
		<span class="hljs-keyword">$this</span>-&gt;_set_error_message($reply);

		<span class="hljs-keyword">$this</span>-&gt;_smtp_end();

		<span class="hljs-keyword">if</span> (strpos($reply, <span class="hljs-string">'250'</span>) !== <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_error'</span>, $reply);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-192" id="section-192"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-193" id="section-193"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP End</p>
</div>
<div class="body">
<p>Shortcut to send RSET or QUIT depending on keep-alive</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_smtp_end</span><span class="hljs-params">()</span>
	</span>{
		(<span class="hljs-keyword">$this</span>-&gt;smtp_keepalive)
			? <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'reset'</span>)
			: <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'quit'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-194" id="section-194"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-195" id="section-195"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Connect</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_smtp_connect</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (is_resource(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect))
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
		}

		$ssl = (<span class="hljs-keyword">$this</span>-&gt;smtp_crypto === <span class="hljs-string">'ssl'</span>) ? <span class="hljs-string">'ssl://'</span> : <span class="hljs-string">''</span>;

		<span class="hljs-keyword">$this</span>-&gt;_smtp_connect = fsockopen($ssl.<span class="hljs-keyword">$this</span>-&gt;smtp_host,
							<span class="hljs-keyword">$this</span>-&gt;smtp_port,
							$errno,
							$errstr,
							<span class="hljs-keyword">$this</span>-&gt;smtp_timeout);

		<span class="hljs-keyword">if</span> ( ! is_resource(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect))
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_error'</span>, $errno.<span class="hljs-string">' '</span>.$errstr);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		stream_set_timeout(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect, <span class="hljs-keyword">$this</span>-&gt;smtp_timeout);
		<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-keyword">$this</span>-&gt;_get_smtp_data());

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;smtp_crypto === <span class="hljs-string">'tls'</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'hello'</span>);
			<span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'starttls'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-196" id="section-196"></a>
</div>
<div class="dox">
<div class="summary">
<p>STREAM_CRYPTO_METHOD_TLS_CLIENT is quite the mess ...</p>
</div>
<div class="body">
<ul>
<li>On PHP &lt;5.6 it doesn't even mean TLS, but SSL 2.0, and there's no option to use actual TLS</li>
<li>On PHP 5.6.0-5.6.6, &gt;=7.2 it means negotiation with any of TLS 1.0, 1.1, 1.2</li>
<li>On PHP 5.6.7-7.1.* it means only TLS 1.0</li>
</ul>
<p>We want the negotiation, so we'll force it below ...</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">			$method = is_php(<span class="hljs-string">'5.6'</span>)
				? STREAM_CRYPTO_METHOD_TLSv1_0_CLIENT | STREAM_CRYPTO_METHOD_TLSv1_1_CLIENT | STREAM_CRYPTO_METHOD_TLSv1_2_CLIENT
				: STREAM_CRYPTO_METHOD_TLS_CLIENT;
			$crypto = stream_socket_enable_crypto(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect, <span class="hljs-keyword">TRUE</span>, $method);

			<span class="hljs-keyword">if</span> ($crypto !== <span class="hljs-keyword">TRUE</span>)
			{
				<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_error'</span>, <span class="hljs-keyword">$this</span>-&gt;_get_smtp_data());
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
			}
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'hello'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-197" id="section-197"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-198" id="section-198"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send SMTP command</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_send_command</span><span class="hljs-params">($cmd, $data = <span class="hljs-string">''</span>)</span>
	</span>{
		<span class="hljs-keyword">switch</span> ($cmd)
		{
			<span class="hljs-keyword">case</span> <span class="hljs-string">'hello'</span> :

						<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_smtp_auth <span class="hljs-keyword">OR</span> <span class="hljs-keyword">$this</span>-&gt;_get_encoding() === <span class="hljs-string">'8bit'</span>)
						{
							<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'EHLO '</span>.<span class="hljs-keyword">$this</span>-&gt;_get_hostname());
						}
						<span class="hljs-keyword">else</span>
						{
							<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'HELO '</span>.<span class="hljs-keyword">$this</span>-&gt;_get_hostname());
						}

						$resp = <span class="hljs-number">250</span>;
			<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'starttls'</span>	:

						<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'STARTTLS'</span>);
						$resp = <span class="hljs-number">220</span>;
			<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'from'</span> :

						<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'MAIL FROM:&lt;'</span>.$data.<span class="hljs-string">'&gt;'</span>);
						$resp = <span class="hljs-number">250</span>;
			<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'to'</span> :

						<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;dsn)
						{
							<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'RCPT TO:&lt;'</span>.$data.<span class="hljs-string">'&gt; NOTIFY=SUCCESS,DELAY,FAILURE ORCPT=rfc822;'</span>.$data);
						}
						<span class="hljs-keyword">else</span>
						{
							<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'RCPT TO:&lt;'</span>.$data.<span class="hljs-string">'&gt;'</span>);
						}

						$resp = <span class="hljs-number">250</span>;
			<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'data'</span>	:

						<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'DATA'</span>);
						$resp = <span class="hljs-number">354</span>;
			<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'reset'</span>:

						<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'RSET'</span>);
						$resp = <span class="hljs-number">250</span>;
			<span class="hljs-keyword">break</span>;
			<span class="hljs-keyword">case</span> <span class="hljs-string">'quit'</span>	:

						<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'QUIT'</span>);
						$resp = <span class="hljs-number">221</span>;
			<span class="hljs-keyword">break</span>;
		}

		$reply = <span class="hljs-keyword">$this</span>-&gt;_get_smtp_data();

		<span class="hljs-keyword">$this</span>-&gt;_debug_msg[] = <span class="hljs-string">'&lt;pre&gt;'</span>.$cmd.<span class="hljs-string">': '</span>.$reply.<span class="hljs-string">'&lt;/pre&gt;'</span>;

		<span class="hljs-keyword">if</span> ((int) <span class="hljs-keyword">self</span>::substr($reply, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>) !== $resp)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_error'</span>, $reply);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">if</span> ($cmd === <span class="hljs-string">'quit'</span>)
		{
			fclose(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect);
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-199" id="section-199"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-200" id="section-200"></a>
</div>
<div class="dox">
<div class="summary">
<p>SMTP Authenticate</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_smtp_authenticate</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;_smtp_auth)
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;smtp_user === <span class="hljs-string">''</span> &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;smtp_pass === <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_no_smtp_unpw'</span>);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;_send_data(<span class="hljs-string">'AUTH LOGIN'</span>);

		$reply = <span class="hljs-keyword">$this</span>-&gt;_get_smtp_data();

		<span class="hljs-keyword">if</span> (strpos($reply, <span class="hljs-string">'503'</span>) === <span class="hljs-number">0</span>)	<span class="hljs-comment">// Already authenticated</span>
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
		}
		<span class="hljs-keyword">elseif</span> (strpos($reply, <span class="hljs-string">'334'</span>) !== <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_failed_smtp_login'</span>, $reply);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;_send_data(base64_encode(<span class="hljs-keyword">$this</span>-&gt;smtp_user));

		$reply = <span class="hljs-keyword">$this</span>-&gt;_get_smtp_data();

		<span class="hljs-keyword">if</span> (strpos($reply, <span class="hljs-string">'334'</span>) !== <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_auth_un'</span>, $reply);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;_send_data(base64_encode(<span class="hljs-keyword">$this</span>-&gt;smtp_pass));

		$reply = <span class="hljs-keyword">$this</span>-&gt;_get_smtp_data();

		<span class="hljs-keyword">if</span> (strpos($reply, <span class="hljs-string">'235'</span>) !== <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_auth_pw'</span>, $reply);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;smtp_keepalive)
		{
			<span class="hljs-keyword">$this</span>-&gt;_smtp_auth = <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-201" id="section-201"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-202" id="section-202"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send SMTP data</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$data
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_send_data</span><span class="hljs-params">($data)</span>
	</span>{
		$data .= <span class="hljs-keyword">$this</span>-&gt;newline;
		<span class="hljs-keyword">for</span> ($written = $timestamp = <span class="hljs-number">0</span>, $length = <span class="hljs-keyword">self</span>::strlen($data); $written &lt; $length; $written += $result)
		{
			<span class="hljs-keyword">if</span> (($result = fwrite(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect, <span class="hljs-keyword">self</span>::substr($data, $written))) === <span class="hljs-keyword">FALSE</span>)
			{
				<span class="hljs-keyword">break</span>;
			}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-203" id="section-203"></a>
</div>
<p>See https://bugs.php.net/bug.php?id=39598 and http://php.net/manual/en/function.fwrite.php#96951</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">elseif</span> ($result === <span class="hljs-number">0</span>)
			{
				<span class="hljs-keyword">if</span> ($timestamp === <span class="hljs-number">0</span>)
				{
					$timestamp = time();
				}
				<span class="hljs-keyword">elseif</span> ($timestamp &lt; (time() - <span class="hljs-keyword">$this</span>-&gt;smtp_timeout))
				{
					$result = <span class="hljs-keyword">FALSE</span>;
					<span class="hljs-keyword">break</span>;
				}

				usleep(<span class="hljs-number">250000</span>);
				<span class="hljs-keyword">continue</span>;
			}

			$timestamp = <span class="hljs-number">0</span>;
		}

		<span class="hljs-keyword">if</span> ($result === <span class="hljs-keyword">FALSE</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_error_message(<span class="hljs-string">'lang:email_smtp_data_failure'</span>, $data);
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-204" id="section-204"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-205" id="section-205"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get SMTP data</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_smtp_data</span><span class="hljs-params">()</span>
	</span>{
		$data = <span class="hljs-string">''</span>;

		<span class="hljs-keyword">while</span> ($str = fgets(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect, <span class="hljs-number">512</span>))
		{
			$data .= $str;

			<span class="hljs-keyword">if</span> ($str[<span class="hljs-number">3</span>] === <span class="hljs-string">' '</span>)
			{
				<span class="hljs-keyword">break</span>;
			}
		}

		<span class="hljs-keyword">return</span> $data;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-206" id="section-206"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-207" id="section-207"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get Hostname</p>
</div>
<div class="body">
<p>There are only two legal types of hostname - either a fully
qualified domain name (eg: &quot;mail.example.com&quot;) or an IP literal
(eg: &quot;[1.2.3.4]&quot;).</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_get_hostname</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">'SERVER_NAME'</span>]))
		{
			<span class="hljs-keyword">return</span> $_SERVER[<span class="hljs-string">'SERVER_NAME'</span>];
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">'SERVER_ADDR'</span>]) ? <span class="hljs-string">'['</span>.$_SERVER[<span class="hljs-string">'SERVER_ADDR'</span>].<span class="hljs-string">']'</span> : <span class="hljs-string">'[127.0.0.1]'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-208" id="section-208"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-209" id="section-209"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get Debug Message</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$include List of raw data chunks to include in the output 					Valid options are: 'headers', 'subject', 'body'
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">print_debugger</span><span class="hljs-params">($include = array<span class="hljs-params">(<span class="hljs-string">'headers'</span>, <span class="hljs-string">'subject'</span>, <span class="hljs-string">'body'</span>)</span>)</span>
	</span>{
		$msg = <span class="hljs-string">''</span>;

		<span class="hljs-keyword">if</span> (count(<span class="hljs-keyword">$this</span>-&gt;_debug_msg) &gt; <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;_debug_msg <span class="hljs-keyword">as</span> $val)
			{
				$msg .= $val;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-210" id="section-210"></a>
</div>
<p>Determine which parts of our raw data needs to be printed</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$raw_data = <span class="hljs-string">''</span>;
		is_array($include) <span class="hljs-keyword">OR</span> $include = <span class="hljs-keyword">array</span>($include);

		<span class="hljs-keyword">if</span> (in_array(<span class="hljs-string">'headers'</span>, $include, <span class="hljs-keyword">TRUE</span>))
		{
			$raw_data = htmlspecialchars(<span class="hljs-keyword">$this</span>-&gt;_header_str).<span class="hljs-string">"\n"</span>;
		}

		<span class="hljs-keyword">if</span> (in_array(<span class="hljs-string">'subject'</span>, $include, <span class="hljs-keyword">TRUE</span>))
		{
			$raw_data .= htmlspecialchars(<span class="hljs-keyword">$this</span>-&gt;_subject).<span class="hljs-string">"\n"</span>;
		}

		<span class="hljs-keyword">if</span> (in_array(<span class="hljs-string">'body'</span>, $include, <span class="hljs-keyword">TRUE</span>))
		{
			$raw_data .= htmlspecialchars(<span class="hljs-keyword">$this</span>-&gt;_finalbody);
		}

		<span class="hljs-keyword">return</span> $msg.($raw_data === <span class="hljs-string">''</span> ? <span class="hljs-string">''</span> : <span class="hljs-string">'&lt;pre&gt;'</span>.$raw_data.<span class="hljs-string">'&lt;/pre&gt;'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-211" id="section-211"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-212" id="section-212"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Message</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$msg
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$val = ''
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_set_error_message</span><span class="hljs-params">($msg, $val = <span class="hljs-string">''</span>)</span>
	</span>{
		$CI =&amp; get_instance();
		$CI-&gt;lang-&gt;load(<span class="hljs-string">'email'</span>);

		<span class="hljs-keyword">if</span> (sscanf($msg, <span class="hljs-string">'lang:%s'</span>, $line) !== <span class="hljs-number">1</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">FALSE</span> === ($line = $CI-&gt;lang-&gt;line($line)))
		{
			<span class="hljs-keyword">$this</span>-&gt;_debug_msg[] = str_replace(<span class="hljs-string">'%s'</span>, $val, $msg).<span class="hljs-string">'&lt;br /&gt;'</span>;
		}
		<span class="hljs-keyword">else</span>
		{
			<span class="hljs-keyword">$this</span>-&gt;_debug_msg[] = str_replace(<span class="hljs-string">'%s'</span>, $val, $line).<span class="hljs-string">'&lt;br /&gt;'</span>;
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-213" id="section-213"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-214" id="section-214"></a>
</div>
<div class="dox">
<div class="summary">
<p>Mime Types</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_mime_types</span><span class="hljs-params">($ext = <span class="hljs-string">''</span>)</span>
	</span>{
		$ext = strtolower($ext);

		$mimes =&amp; get_mimes();

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($mimes[$ext]))
		{
			<span class="hljs-keyword">return</span> is_array($mimes[$ext])
				? current($mimes[$ext])
				: $mimes[$ext];
		}

		<span class="hljs-keyword">return</span> <span class="hljs-string">'application/x-unknown-content-type'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-215" id="section-215"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-216" id="section-216"></a>
</div>
<div class="dox">
<div class="summary">
<p>Destructor</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__destruct</span><span class="hljs-params">()</span>
	</span>{
		is_resource(<span class="hljs-keyword">$this</span>-&gt;_smtp_connect) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;_send_command(<span class="hljs-string">'quit'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-217" id="section-217"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-218" id="section-218"></a>
</div>
<div class="dox">
<div class="summary">
<p>Byte-safe strlen()</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$str
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>int
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">strlen</span><span class="hljs-params">($str)</span>
	</span>{
		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">self</span>::$func_overload)
			? mb_strlen($str, <span class="hljs-string">'8bit'</span>)
			: strlen($str);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-219" id="section-219"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-220" id="section-220"></a>
</div>
<div class="dox">
<div class="summary">
<p>Byte-safe substr()</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$str
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
<span>$start
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
<span>$length
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">substr</span><span class="hljs-params">($str, $start, $length = NULL)</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">self</span>::$func_overload)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-221" id="section-221"></a>
</div>
<p>mb_substr($str, $start, null, '8bit') returns an empty
string on PHP 5.3</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">isset</span>($length) <span class="hljs-keyword">OR</span> $length = ($start &gt;= <span class="hljs-number">0</span> ? <span class="hljs-keyword">self</span>::strlen($str) - $start : -$start);
			<span class="hljs-keyword">return</span> mb_substr($str, $start, $length, <span class="hljs-string">'8bit'</span>);
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">isset</span>($length)
			? substr($str, $start, $length)
			: substr($str, $start);
	}
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>

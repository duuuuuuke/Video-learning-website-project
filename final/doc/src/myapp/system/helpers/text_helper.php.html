<!DOCTYPE html>
<html>
<head>
  <title>text_helper.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "src\\myapp\\system\\helpers\\text_helper.php";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>text_helper.php</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-meta">&lt;?php</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>CodeIgniter</p>
</div>
<div class="body">
<p>An open source application development framework for PHP</p>
<p>This content is released under the MIT License (MIT)</p>
<p>Copyright (c) 2014 - 2019, British Columbia Institute of Technology</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">defined(<span class="hljs-string">'BASEPATH'</span>) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">exit</span>(<span class="hljs-string">'No direct script access allowed'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>CodeIgniter Text Helpers</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'word_limiter'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Word Limiter</p>
</div>
<div class="body">
<p>Limits a string to X number of words.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>the end character. Usually an ellipsis
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">word_limiter</span><span class="hljs-params">($str, $limit = <span class="hljs-number">100</span>, $end_char = <span class="hljs-string">'&amp;#8230;'</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> (trim($str) === <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">return</span> $str;
		}

		preg_match(<span class="hljs-string">'/^\s*+(?:\S++\s*+){1,'</span>.(int) $limit.<span class="hljs-string">'}/'</span>, $str, $matches);

		<span class="hljs-keyword">if</span> (strlen($str) === strlen($matches[<span class="hljs-number">0</span>]))
		{
			$end_char = <span class="hljs-string">''</span>;
		}

		<span class="hljs-keyword">return</span> rtrim($matches[<span class="hljs-number">0</span>]).$end_char;
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'character_limiter'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Character Limiter</p>
</div>
<div class="body">
<p>Limits the string based on the character count.  Preserves complete words
so the character count may not be exactly as specified.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>the end character. Usually an ellipsis
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">character_limiter</span><span class="hljs-params">($str, $n = <span class="hljs-number">500</span>, $end_char = <span class="hljs-string">'&amp;#8230;'</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> (mb_strlen($str) &lt; $n)
		{
			<span class="hljs-keyword">return</span> $str;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>a bit complicated, but faster than preg_replace with \s+</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = preg_replace(<span class="hljs-string">'/ {2,}/'</span>, <span class="hljs-string">' '</span>, str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"\t"</span>, <span class="hljs-string">"\v"</span>, <span class="hljs-string">"\f"</span>), <span class="hljs-string">' '</span>, $str));

		<span class="hljs-keyword">if</span> (mb_strlen($str) &lt;= $n)
		{
			<span class="hljs-keyword">return</span> $str;
		}

		$out = <span class="hljs-string">''</span>;
		<span class="hljs-keyword">foreach</span> (explode(<span class="hljs-string">' '</span>, trim($str)) <span class="hljs-keyword">as</span> $val)
		{
			$out .= $val.<span class="hljs-string">' '</span>;

			<span class="hljs-keyword">if</span> (mb_strlen($out) &gt;= $n)
			{
				$out = trim($out);
				<span class="hljs-keyword">return</span> (mb_strlen($out) === mb_strlen($str)) ? $out : $out.$end_char;
			}
		}
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'ascii_to_entities'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>High ASCII to Entities</p>
</div>
<div class="body">
<p>Converts high ASCII text and MS Word special characters to character entities</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$str
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ascii_to_entities</span><span class="hljs-params">($str)</span>
	</span>{
		$out = <span class="hljs-string">''</span>;
		$length = defined(<span class="hljs-string">'MB_OVERLOAD_STRING'</span>)
			? mb_strlen($str, <span class="hljs-string">'8bit'</span>) - <span class="hljs-number">1</span>
			: strlen($str) - <span class="hljs-number">1</span>;
		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $count = <span class="hljs-number">1</span>, $temp = <span class="hljs-keyword">array</span>(); $i &lt;= $length; $i++)
		{
			$ordinal = ord($str[$i]);

			<span class="hljs-keyword">if</span> ($ordinal &lt; <span class="hljs-number">128</span>)
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>If the $temp array has a value but we have moved on, then it seems only
fair that we output that entity and restart $temp before continuing. -Paul</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> (count($temp) === <span class="hljs-number">1</span>)
				{
					$out .= <span class="hljs-string">'&amp;#'</span>.array_shift($temp).<span class="hljs-string">';'</span>;
					$count = <span class="hljs-number">1</span>;
				}

				$out .= $str[$i];
			}
			<span class="hljs-keyword">else</span>
			{
				<span class="hljs-keyword">if</span> (count($temp) === <span class="hljs-number">0</span>)
				{
					$count = ($ordinal &lt; <span class="hljs-number">224</span>) ? <span class="hljs-number">2</span> : <span class="hljs-number">3</span>;
				}

				$temp[] = $ordinal;

				<span class="hljs-keyword">if</span> (count($temp) === $count)
				{
					$number = ($count === <span class="hljs-number">3</span>)
						? (($temp[<span class="hljs-number">0</span>] % <span class="hljs-number">16</span>) * <span class="hljs-number">4096</span>) + (($temp[<span class="hljs-number">1</span>] % <span class="hljs-number">64</span>) * <span class="hljs-number">64</span>) + ($temp[<span class="hljs-number">2</span>] % <span class="hljs-number">64</span>)
						: (($temp[<span class="hljs-number">0</span>] % <span class="hljs-number">32</span>) * <span class="hljs-number">64</span>) + ($temp[<span class="hljs-number">1</span>] % <span class="hljs-number">64</span>);

					$out .= <span class="hljs-string">'&amp;#'</span>.$number.<span class="hljs-string">';'</span>;
					$count = <span class="hljs-number">1</span>;
					$temp = <span class="hljs-keyword">array</span>();
				}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>If this is the last iteration, just output whatever we have</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">elseif</span> ($i === $length)
				{
					$out .= <span class="hljs-string">'&amp;#'</span>.implode(<span class="hljs-string">';'</span>, $temp).<span class="hljs-string">';'</span>;
				}
			}
		}

		<span class="hljs-keyword">return</span> $out;
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'entities_to_ascii'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Entities to ASCII</p>
</div>
<div class="body">
<p>Converts character entities back to ASCII</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">entities_to_ascii</span><span class="hljs-params">($str, $all = TRUE)</span>
	</span>{
		<span class="hljs-keyword">if</span> (preg_match_all(<span class="hljs-string">'/\&amp;#(\d+)\;/'</span>, $str, $matches))
		{
			<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $s = count($matches[<span class="hljs-number">0</span>]); $i &lt; $s; $i++)
			{
				$digits = $matches[<span class="hljs-number">1</span>][$i];
				$out = <span class="hljs-string">''</span>;

				<span class="hljs-keyword">if</span> ($digits &lt; <span class="hljs-number">128</span>)
				{
					$out .= chr($digits);

				}
				<span class="hljs-keyword">elseif</span> ($digits &lt; <span class="hljs-number">2048</span>)
				{
					$out .= chr(<span class="hljs-number">192</span> + (($digits - ($digits % <span class="hljs-number">64</span>)) / <span class="hljs-number">64</span>)).chr(<span class="hljs-number">128</span> + ($digits % <span class="hljs-number">64</span>));
				}
				<span class="hljs-keyword">else</span>
				{
					$out .= chr(<span class="hljs-number">224</span> + (($digits - ($digits % <span class="hljs-number">4096</span>)) / <span class="hljs-number">4096</span>))
						.chr(<span class="hljs-number">128</span> + ((($digits % <span class="hljs-number">4096</span>) - ($digits % <span class="hljs-number">64</span>)) / <span class="hljs-number">64</span>))
						.chr(<span class="hljs-number">128</span> + ($digits % <span class="hljs-number">64</span>));
				}

				$str = str_replace($matches[<span class="hljs-number">0</span>][$i], $out, $str);
			}
		}

		<span class="hljs-keyword">if</span> ($all)
		{
			<span class="hljs-keyword">return</span> str_replace(
				<span class="hljs-keyword">array</span>(<span class="hljs-string">'&amp;amp;'</span>, <span class="hljs-string">'&amp;lt;'</span>, <span class="hljs-string">'&amp;gt;'</span>, <span class="hljs-string">'&amp;quot;'</span>, <span class="hljs-string">'&amp;apos;'</span>, <span class="hljs-string">'&amp;#45;'</span>),
				<span class="hljs-keyword">array</span>(<span class="hljs-string">'&amp;'</span>, <span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">"'"</span>, <span class="hljs-string">'-'</span>),
				$str
			);
		}

		<span class="hljs-keyword">return</span> $str;
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'word_censor'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Word Censoring Function</p>
</div>
<div class="body">
<p>Supply a string and an array of disallowed words and any
matched words will be converted to #### or to the replacement
word you've submitted.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>the text string
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>the array of censored words
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>the optional replacement value
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">word_censor</span><span class="hljs-params">($str, $censored, $replacement = <span class="hljs-string">''</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! is_array($censored))
		{
			<span class="hljs-keyword">return</span> $str;
		}

		$str = <span class="hljs-string">' '</span>.$str.<span class="hljs-string">' '</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>\w, \b and a few others do not match on a unicode character
set for performance reasons. As a result words like Ã¼ber
will not match on a word boundary. Instead, we'll assume that
a bad word will be bookeneded by any of these characters.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$delim = <span class="hljs-string">'[-_\'\"`(){}&lt;&gt;\[\]|!?@#%&amp;,.:;^~*+=\/ 0-9\n\r\t]'</span>;

		<span class="hljs-keyword">foreach</span> ($censored <span class="hljs-keyword">as</span> $badword)
		{
			$badword = str_replace(<span class="hljs-string">'\*'</span>, <span class="hljs-string">'\w*?'</span>, preg_quote($badword, <span class="hljs-string">'/'</span>));
			<span class="hljs-keyword">if</span> ($replacement !== <span class="hljs-string">''</span>)
			{
				$str = preg_replace(
					<span class="hljs-string">"/({$delim})("</span>.$badword.<span class="hljs-string">")({$delim})/i"</span>,
					<span class="hljs-string">"\\1{$replacement}\\3"</span>,
					$str
				);
			}
			<span class="hljs-keyword">elseif</span> (preg_match_all(<span class="hljs-string">"/{$delim}("</span>.$badword.<span class="hljs-string">"){$delim}/i"</span>, $str, $matches, PREG_PATTERN_ORDER | PREG_OFFSET_CAPTURE))
			{
				$matches = $matches[<span class="hljs-number">1</span>];
				<span class="hljs-keyword">for</span> ($i = count($matches) - <span class="hljs-number">1</span>; $i &gt;= <span class="hljs-number">0</span>; $i--)
				{
					$length = strlen($matches[$i][<span class="hljs-number">0</span>]);
					$str = substr_replace(
						$str,
						str_repeat(<span class="hljs-string">'#'</span>, $length),
						$matches[$i][<span class="hljs-number">1</span>],
						$length
					);
				}
			}
		}

		<span class="hljs-keyword">return</span> trim($str);
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'highlight_code'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<div class="dox">
<div class="summary">
<p>Code Highlighter</p>
</div>
<div class="body">
<p>Colorizes code strings</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>the text string
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlight_code</span><span class="hljs-params">($str)</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<div class="dox">
<div class="summary">
<p>The highlight string function encodes and highlights
brackets so we need them to start raw.</p>
</div>
<div class="body">
<p>Also replace any existing PHP tags to temporary markers
so they don't accidentally break the string out of PHP,
and thus, thwart the highlighting.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = str_replace(
			<span class="hljs-keyword">array</span>(<span class="hljs-string">'&amp;lt;'</span>, <span class="hljs-string">'&amp;gt;'</span>, <span class="hljs-string">'&lt;?'</span>, <span class="hljs-string">'?&gt;'</span>, <span class="hljs-string">'&lt;%'</span>, <span class="hljs-string">'%&gt;'</span>, <span class="hljs-string">'\\'</span>, <span class="hljs-string">'&lt;/script&gt;'</span>),
			<span class="hljs-keyword">array</span>(<span class="hljs-string">'&lt;'</span>, <span class="hljs-string">'&gt;'</span>, <span class="hljs-string">'phptagopen'</span>, <span class="hljs-string">'phptagclose'</span>, <span class="hljs-string">'asptagopen'</span>, <span class="hljs-string">'asptagclose'</span>, <span class="hljs-string">'backslashtmp'</span>, <span class="hljs-string">'scriptclose'</span>),
			$str
		);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>The highlight_string function requires that the text be surrounded
by PHP tags, which we will remove later</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = highlight_string(<span class="hljs-string">'&lt;?php '</span>.$str.<span class="hljs-string">' ?&gt;'</span>, <span class="hljs-keyword">TRUE</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Remove our artificially added PHP, and the syntax highlighting that came with it</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = preg_replace(
			<span class="hljs-keyword">array</span>(
				<span class="hljs-string">'/&lt;span style="color: #([A-Z0-9]+)"&gt;&amp;lt;\?php(&amp;nbsp;| )/i'</span>,
				<span class="hljs-string">'/(&lt;span style="color: #[A-Z0-9]+"&gt;.*?)\?&amp;gt;&lt;\/span&gt;\n&lt;\/span&gt;\n&lt;\/code&gt;/is'</span>,
				<span class="hljs-string">'/&lt;span style="color: #[A-Z0-9]+"\&gt;&lt;\/span&gt;/i'</span>
			),
			<span class="hljs-keyword">array</span>(
				<span class="hljs-string">'&lt;span style="color: #$1"&gt;'</span>,
				<span class="hljs-string">"$1&lt;/span&gt;\n&lt;/span&gt;\n&lt;/code&gt;"</span>,
				<span class="hljs-string">''</span>
			),
			$str
		);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Replace our markers back to PHP tags.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">return</span> str_replace(
			<span class="hljs-keyword">array</span>(<span class="hljs-string">'phptagopen'</span>, <span class="hljs-string">'phptagclose'</span>, <span class="hljs-string">'asptagopen'</span>, <span class="hljs-string">'asptagclose'</span>, <span class="hljs-string">'backslashtmp'</span>, <span class="hljs-string">'scriptclose'</span>),
			<span class="hljs-keyword">array</span>(<span class="hljs-string">'&amp;lt;?'</span>, <span class="hljs-string">'?&amp;gt;'</span>, <span class="hljs-string">'&amp;lt;%'</span>, <span class="hljs-string">'%&amp;gt;'</span>, <span class="hljs-string">'\\'</span>, <span class="hljs-string">'&amp;lt;/script&amp;gt;'</span>),
			$str
		);
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'highlight_phrase'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<div class="dox">
<div class="summary">
<p>Phrase Highlighter</p>
</div>
<div class="body">
<p>Highlights a phrase within a text string</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$str the text string
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$phrase the phrase you'd like to highlight
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$tag_open the openging tag to precede the phrase with
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$tag_close the closing tag to end the phrase with
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">highlight_phrase</span><span class="hljs-params">($str, $phrase, $tag_open = <span class="hljs-string">'&lt;mark&gt;'</span>, $tag_close = <span class="hljs-string">'&lt;/mark&gt;'</span>)</span>
	</span>{
		<span class="hljs-keyword">return</span> ($str !== <span class="hljs-string">''</span> &amp;&amp; $phrase !== <span class="hljs-string">''</span>)
			? preg_replace(<span class="hljs-string">'/('</span>.preg_quote($phrase, <span class="hljs-string">'/'</span>).<span class="hljs-string">')/i'</span>.(UTF8_ENABLED ? <span class="hljs-string">'u'</span> : <span class="hljs-string">''</span>), $tag_open.<span class="hljs-string">'\\1'</span>.$tag_close, $str)
			: $str;
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'convert_accented_characters'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<div class="dox">
<div class="summary">
<p>Convert Accented Foreign Characters to ASCII</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$str Input string
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">convert_accented_characters</span><span class="hljs-params">($str)</span>
	</span>{
		<span class="hljs-keyword">static</span> $array_from, $array_to;

		<span class="hljs-keyword">if</span> ( ! is_array($array_from))
		{
			<span class="hljs-keyword">if</span> (file_exists(APPPATH.<span class="hljs-string">'config/foreign_chars.php'</span>))
			{
				<span class="hljs-keyword">include</span>(APPPATH.<span class="hljs-string">'config/foreign_chars.php'</span>);
			}

			<span class="hljs-keyword">if</span> (file_exists(APPPATH.<span class="hljs-string">'config/'</span>.ENVIRONMENT.<span class="hljs-string">'/foreign_chars.php'</span>))
			{
				<span class="hljs-keyword">include</span>(APPPATH.<span class="hljs-string">'config/'</span>.ENVIRONMENT.<span class="hljs-string">'/foreign_chars.php'</span>);
			}

			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($foreign_characters) <span class="hljs-keyword">OR</span> ! is_array($foreign_characters))
			{
				$array_from = <span class="hljs-keyword">array</span>();
				$array_to = <span class="hljs-keyword">array</span>();

				<span class="hljs-keyword">return</span> $str;
			}

			$array_from = array_keys($foreign_characters);
			$array_to = array_values($foreign_characters);
		}

		<span class="hljs-keyword">return</span> preg_replace($array_from, $array_to, $str);
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'word_wrap'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<div class="dox">
<div class="summary">
<p>Word Wrap</p>
</div>
<div class="body">
<p>Wraps text at the specified character. Maintains the integrity of words.
Anything placed between {unwrap}{/unwrap} will not be word wrapped, nor
will URLs.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$str the text string
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
<span>$charlim = 76 the number of characters to wrap at
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">word_wrap</span><span class="hljs-params">($str, $charlim = <span class="hljs-number">76</span>)</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Set the character limit</p>

        </td>
        <td class="code highlight">
          <pre class="php">		is_numeric($charlim) <span class="hljs-keyword">OR</span> $charlim = <span class="hljs-number">76</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Reduce multiple spaces</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = preg_replace(<span class="hljs-string">'| +|'</span>, <span class="hljs-string">' '</span>, $str);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Standardize newlines</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (strpos($str, <span class="hljs-string">"\r"</span>) !== <span class="hljs-keyword">FALSE</span>)
		{
			$str = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\r\n"</span>, <span class="hljs-string">"\r"</span>), <span class="hljs-string">"\n"</span>, $str);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>If the current word is surrounded by {unwrap} tags we'll
strip the entire chunk and replace it with a marker.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$unwrap = <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">if</span> (preg_match_all(<span class="hljs-string">'|\{unwrap\}(.+?)\{/unwrap\}|s'</span>, $str, $matches))
		{
			<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count($matches[<span class="hljs-number">0</span>]); $i &lt; $c; $i++)
			{
				$unwrap[] = $matches[<span class="hljs-number">1</span>][$i];
				$str = str_replace($matches[<span class="hljs-number">0</span>][$i], <span class="hljs-string">'{{unwrapped'</span>.$i.<span class="hljs-string">'}}'</span>, $str);
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Use PHP's native function to do the initial wordwrap.
We set the cut flag to FALSE so that any individual words that are
too long get left alone. In the next step we'll deal with them.</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = wordwrap($str, $charlim, <span class="hljs-string">"\n"</span>, <span class="hljs-keyword">FALSE</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Split the string into individual lines of text and cycle through them</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$output = <span class="hljs-string">''</span>;
		<span class="hljs-keyword">foreach</span> (explode(<span class="hljs-string">"\n"</span>, $str) <span class="hljs-keyword">as</span> $line)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>Is the line within the allowed character count?
If so we'll join it to the output and continue</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> (mb_strlen($line) &lt;= $charlim)
			{
				$output .= $line.<span class="hljs-string">"\n"</span>;
				<span class="hljs-keyword">continue</span>;
			}

			$temp = <span class="hljs-string">''</span>;
			<span class="hljs-keyword">while</span> (mb_strlen($line) &gt; $charlim)
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>If the over-length word is a URL we won't wrap it</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'!\[url.+\]|://|www\.!'</span>, $line))
				{
					<span class="hljs-keyword">break</span>;
				}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Trim the word down</p>

        </td>
        <td class="code highlight">
          <pre class="php">				$temp .= mb_substr($line, <span class="hljs-number">0</span>, $charlim - <span class="hljs-number">1</span>);
				$line = mb_substr($line, $charlim - <span class="hljs-number">1</span>);
			}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>If $temp contains data it means we had to split up an over-length
word into smaller chunks so we'll add it back to our current line</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> ($temp !== <span class="hljs-string">''</span>)
			{
				$output .= $temp.<span class="hljs-string">"\n"</span>.$line.<span class="hljs-string">"\n"</span>;
			}
			<span class="hljs-keyword">else</span>
			{
				$output .= $line.<span class="hljs-string">"\n"</span>;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>Put our markers back</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (count($unwrap) &gt; <span class="hljs-number">0</span>)
		{
			<span class="hljs-keyword">foreach</span> ($unwrap <span class="hljs-keyword">as</span> $key =&gt; $val)
			{
				$output = str_replace(<span class="hljs-string">'{{unwrapped'</span>.$key.<span class="hljs-string">'}}'</span>, $val, $output);
			}
		}

		<span class="hljs-keyword">return</span> $output;
	}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
<span class="hljs-keyword">if</span> ( ! function_exists(<span class="hljs-string">'ellipsize'</span>))
{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<div class="dox">
<div class="summary">
<p>Ellipsize String</p>
</div>
<div class="body">
<p>This function will strip tags from a string, split it at its max_length and ellipsize</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>string to ellipsize
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">int</span>
<span>max length of string
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">mixed</span>
<span>int (1|0) or float, .5, .2, etc for position to split
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>ellipsis ; Default '...'
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string ellipsized string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ellipsize</span><span class="hljs-params">($str, $max_length, $position = <span class="hljs-number">1</span>, $ellipsis = <span class="hljs-string">'&amp;hellip;'</span>)</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Strip tags</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$str = trim(strip_tags($str));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>Is the string long enough to ellipsize?</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (mb_strlen($str) &lt;= $max_length)
		{
			<span class="hljs-keyword">return</span> $str;
		}

		$beg = mb_substr($str, <span class="hljs-number">0</span>, floor($max_length * $position));
		$position = ($position &gt; <span class="hljs-number">1</span>) ? <span class="hljs-number">1</span> : $position;

		<span class="hljs-keyword">if</span> ($position === <span class="hljs-number">1</span>)
		{
			$end = mb_substr($str, <span class="hljs-number">0</span>, -($max_length - mb_strlen($beg)));
		}
		<span class="hljs-keyword">else</span>
		{
			$end = mb_substr($str, -($max_length - mb_strlen($beg)));
		}

		<span class="hljs-keyword">return</span> $beg.$ellipsis.$end;
	}
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>

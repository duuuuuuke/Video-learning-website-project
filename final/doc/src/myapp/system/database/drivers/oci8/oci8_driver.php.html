<!DOCTYPE html>
<html>
<head>
  <title>oci8_driver.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../";
    var thisFile = "src\\myapp\\system\\database\\drivers\\oci8\\oci8_driver.php";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>oci8_driver.php</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-meta">&lt;?php</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>CodeIgniter</p>
</div>
<div class="body">
<p>An open source application development framework for PHP</p>
<p>This content is released under the MIT License (MIT)</p>
<p>Copyright (c) 2014 - 2019, British Columbia Institute of Technology</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">defined(<span class="hljs-string">'BASEPATH'</span>) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">exit</span>(<span class="hljs-string">'No direct script access allowed'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>oci8 Database Adapter Class</p>
</div>
<div class="body">
<p>Note: _DB is an extender class that the app controller
creates dynamically based on whether the query builder
class is being used or not.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>oci8 Database Adapter Class</p>
</div>
<div class="body">
<p>This is a modification of the DB_driver class to
permit access to oracle databases</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CI_DB_oci8_driver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">CI_DB</span> </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Database driver</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $dbdriver = <span class="hljs-string">'oci8'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Statement ID</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $stmt_id;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Cursor ID</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $curs_id;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Commit mode flag</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $commit_mode = OCI_COMMIT_ON_SUCCESS;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Limit used flag</p>
</div>
<div class="body">
<p>If we use LIMIT, we'll add a field that will
throw off num_fields later.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $limit_used = <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Reset $stmt_id flag</p>
</div>
<div class="body">
<p>Used by stored_procedure() to prevent _execute() from
re-setting the statement ID.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_reset_stmt_id = <span class="hljs-keyword">TRUE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>List of reserved identifiers</p>
</div>
<div class="body">
<p>Identifiers that must NOT be escaped.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_reserved_identifiers = <span class="hljs-keyword">array</span>(<span class="hljs-string">'*'</span>, <span class="hljs-string">'rownum'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>ORDER BY random keyword</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_random_keyword = <span class="hljs-keyword">array</span>(<span class="hljs-string">'ASC'</span>, <span class="hljs-string">'ASC'</span>); <span class="hljs-comment">// not currently supported</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>COUNT string</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> $_count_string = <span class="hljs-string">'SELECT COUNT(1) AS '</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Class constructor</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$params
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($params)</span>
	</span>{
		<span class="hljs-keyword">parent</span>::__construct($params);

		$valid_dsns = <span class="hljs-keyword">array</span>(
			<span class="hljs-string">'tns'</span>	=&gt; <span class="hljs-string">'/^\(DESCRIPTION=(\(.+\)){2,}\)$/'</span>, <span class="hljs-comment">// TNS</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Easy Connect string (Oracle 10g+)</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-string">'ec'</span>	=&gt; <span class="hljs-string">'/^(\/\/)?[a-z0-9.:_-]+(:[1-9][0-9]{0,4})?(\/[a-z0-9$_]+)?(:[^\/])?(\/[a-z0-9$_]+)?$/i'</span>,
			<span class="hljs-string">'in'</span>	=&gt; <span class="hljs-string">'/^[a-z0-9$_]+$/i'</span> <span class="hljs-comment">// Instance name (defined in tnsnames.ora)</span>
		);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Space characters don't have any effect when actually
connecting, but can be a hassle while validating the DSN.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">$this</span>-&gt;dsn = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\t"</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">''</span>, <span class="hljs-keyword">$this</span>-&gt;dsn);

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;dsn !== <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">foreach</span> ($valid_dsns <span class="hljs-keyword">as</span> $regexp)
			{
				<span class="hljs-keyword">if</span> (preg_match($regexp, <span class="hljs-keyword">$this</span>-&gt;dsn))
				{
					<span class="hljs-keyword">return</span>;
				}
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Legacy support for TNS in the hostname configuration field</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">$this</span>-&gt;hostname = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\t"</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">''</span>, <span class="hljs-keyword">$this</span>-&gt;hostname);
		<span class="hljs-keyword">if</span> (preg_match($valid_dsns[<span class="hljs-string">'tns'</span>], <span class="hljs-keyword">$this</span>-&gt;hostname))
		{
			<span class="hljs-keyword">$this</span>-&gt;dsn = <span class="hljs-keyword">$this</span>-&gt;hostname;
			<span class="hljs-keyword">return</span>;
		}
		<span class="hljs-keyword">elseif</span> (<span class="hljs-keyword">$this</span>-&gt;hostname !== <span class="hljs-string">''</span> &amp;&amp; strpos(<span class="hljs-keyword">$this</span>-&gt;hostname, <span class="hljs-string">'/'</span>) === <span class="hljs-keyword">FALSE</span> &amp;&amp; strpos(<span class="hljs-keyword">$this</span>-&gt;hostname, <span class="hljs-string">':'</span>) === <span class="hljs-keyword">FALSE</span>
			&amp;&amp; (( ! <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;port) &amp;&amp; ctype_digit(<span class="hljs-keyword">$this</span>-&gt;port)) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">$this</span>-&gt;database !== <span class="hljs-string">''</span>))
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<div class="dox">
<div class="summary">
<p>If the hostname field isn't empty, doesn't contain
':' and/or '/' and if port and/or database aren't
empty, then the hostname field is most likely indeed
just a hostname. Therefore we'll try and build an
Easy Connect string from these 3 settings, assuming
that the database field is a service name.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">$this</span>-&gt;dsn = <span class="hljs-keyword">$this</span>-&gt;hostname
				.(( ! <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;port) &amp;&amp; ctype_digit(<span class="hljs-keyword">$this</span>-&gt;port)) ? <span class="hljs-string">':'</span>.<span class="hljs-keyword">$this</span>-&gt;port : <span class="hljs-string">''</span>)
				.(<span class="hljs-keyword">$this</span>-&gt;database !== <span class="hljs-string">''</span> ? <span class="hljs-string">'/'</span>.ltrim(<span class="hljs-keyword">$this</span>-&gt;database, <span class="hljs-string">'/'</span>) : <span class="hljs-string">''</span>);

			<span class="hljs-keyword">if</span> (preg_match($valid_dsns[<span class="hljs-string">'ec'</span>], <span class="hljs-keyword">$this</span>-&gt;dsn))
			{
				<span class="hljs-keyword">return</span>;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>At this point, we can only try and validate the hostname and
database fields separately as DSNs.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (preg_match($valid_dsns[<span class="hljs-string">'ec'</span>], <span class="hljs-keyword">$this</span>-&gt;hostname) <span class="hljs-keyword">OR</span> preg_match($valid_dsns[<span class="hljs-string">'in'</span>], <span class="hljs-keyword">$this</span>-&gt;hostname))
		{
			<span class="hljs-keyword">$this</span>-&gt;dsn = <span class="hljs-keyword">$this</span>-&gt;hostname;
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;database = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">"\n"</span>, <span class="hljs-string">"\r"</span>, <span class="hljs-string">"\t"</span>, <span class="hljs-string">' '</span>), <span class="hljs-string">''</span>, <span class="hljs-keyword">$this</span>-&gt;database);
		<span class="hljs-keyword">foreach</span> ($valid_dsns <span class="hljs-keyword">as</span> $regexp)
		{
			<span class="hljs-keyword">if</span> (preg_match($regexp, <span class="hljs-keyword">$this</span>-&gt;database))
			{
				<span class="hljs-keyword">return</span>;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>Well - OK, an empty string should work as well.
PHP will try to use environment variables to
determine which Oracle instance to connect to.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">$this</span>-&gt;dsn = <span class="hljs-string">''</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<div class="dox">
<div class="summary">
<p>Non-persistent database connection</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
<span>$persistent
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>resource
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">db_connect</span><span class="hljs-params">($persistent = FALSE)</span>
	</span>{
		$func = ($persistent === <span class="hljs-keyword">TRUE</span>) ? <span class="hljs-string">'oci_pconnect'</span> : <span class="hljs-string">'oci_connect'</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;char_set)
			? $func(<span class="hljs-keyword">$this</span>-&gt;username, <span class="hljs-keyword">$this</span>-&gt;password, <span class="hljs-keyword">$this</span>-&gt;dsn)
			: $func(<span class="hljs-keyword">$this</span>-&gt;username, <span class="hljs-keyword">$this</span>-&gt;password, <span class="hljs-keyword">$this</span>-&gt;dsn, <span class="hljs-keyword">$this</span>-&gt;char_set);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<div class="dox">
<div class="summary">
<p>Database version number</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">version</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;data_cache[<span class="hljs-string">'version'</span>]))
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;data_cache[<span class="hljs-string">'version'</span>];
		}

		<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">$this</span>-&gt;conn_id <span class="hljs-keyword">OR</span> ($version_string = oci_server_version(<span class="hljs-keyword">$this</span>-&gt;conn_id)) === <span class="hljs-keyword">FALSE</span>)
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}
		<span class="hljs-keyword">elseif</span> (preg_match(<span class="hljs-string">'#Release\s(\d+(?:\.\d+)+)#'</span>, $version_string, $match))
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;data_cache[<span class="hljs-string">'version'</span>] = $match[<span class="hljs-number">1</span>];
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Execute the query</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$sql an SQL query
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>resource
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_execute</span><span class="hljs-params">($sql)</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<div class="dox">
<div class="summary">
<p>Oracle must parse the query before it is run. All of the actions with
the query are based on the statement id returned by oci_parse().</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;_reset_stmt_id === <span class="hljs-keyword">TRUE</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;stmt_id = oci_parse(<span class="hljs-keyword">$this</span>-&gt;conn_id, $sql);
		}

		oci_set_prefetch(<span class="hljs-keyword">$this</span>-&gt;stmt_id, <span class="hljs-number">1000</span>);
		<span class="hljs-keyword">return</span> oci_execute(<span class="hljs-keyword">$this</span>-&gt;stmt_id, <span class="hljs-keyword">$this</span>-&gt;commit_mode);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get cursor. Returns a cursor from the database</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>resource
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_cursor</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;curs_id = oci_new_cursor(<span class="hljs-keyword">$this</span>-&gt;conn_id);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<div class="dox">
<div class="summary">
<p>Stored Procedure.  Executes a stored procedure</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>package name in which the stored procedure is in
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>stored procedure name to execute
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>parameters
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>mixed
params array keys
KEY      OPTIONAL  NOTES
name     no        the name of the parameter should be in :&lt;param_name&gt; format
value    no        the value of the parameter.  If this is an OUT or IN OUT parameter,
this should be a reference to a variable
type     yes       the type of the parameter
length   yes       the max size of the parameter
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stored_procedure</span><span class="hljs-params">($package, $procedure, array $params)</span>
	</span>{
		<span class="hljs-keyword">if</span> ($package === <span class="hljs-string">''</span> <span class="hljs-keyword">OR</span> $procedure === <span class="hljs-string">''</span>)
		{
			log_message(<span class="hljs-string">'error'</span>, <span class="hljs-string">'Invalid query: '</span>.$package.<span class="hljs-string">'.'</span>.$procedure);
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">$this</span>-&gt;db_debug) ? <span class="hljs-keyword">$this</span>-&gt;display_error(<span class="hljs-string">'db_invalid_query'</span>) : <span class="hljs-keyword">FALSE</span>;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Build the query string</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$sql = <span class="hljs-string">'BEGIN '</span>.$package.<span class="hljs-string">'.'</span>.$procedure.<span class="hljs-string">'('</span>;

		$have_cursor = <span class="hljs-keyword">FALSE</span>;
		<span class="hljs-keyword">foreach</span> ($params <span class="hljs-keyword">as</span> $param)
		{
			$sql .= $param[<span class="hljs-string">'name'</span>].<span class="hljs-string">','</span>;

			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($param[<span class="hljs-string">'type'</span>]) &amp;&amp; $param[<span class="hljs-string">'type'</span>] === OCI_B_CURSOR)
			{
				$have_cursor = <span class="hljs-keyword">TRUE</span>;
			}
		}
		$sql = trim($sql, <span class="hljs-string">','</span>).<span class="hljs-string">'); END;'</span>;

		<span class="hljs-keyword">$this</span>-&gt;_reset_stmt_id = <span class="hljs-keyword">FALSE</span>;
		<span class="hljs-keyword">$this</span>-&gt;stmt_id = oci_parse(<span class="hljs-keyword">$this</span>-&gt;conn_id, $sql);
		<span class="hljs-keyword">$this</span>-&gt;_bind_params($params);
		$result = <span class="hljs-keyword">$this</span>-&gt;query($sql, <span class="hljs-keyword">FALSE</span>, $have_cursor);
		<span class="hljs-keyword">$this</span>-&gt;_reset_stmt_id = <span class="hljs-keyword">TRUE</span>;
		<span class="hljs-keyword">return</span> $result;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<div class="dox">
<div class="summary">
<p>Bind parameters</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$params
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_bind_params</span><span class="hljs-params">($params)</span>
	</span>{
		<span class="hljs-keyword">if</span> ( ! is_array($params) <span class="hljs-keyword">OR</span> ! is_resource(<span class="hljs-keyword">$this</span>-&gt;stmt_id))
		{
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">foreach</span> ($params <span class="hljs-keyword">as</span> $param)
		{
			<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">array</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'value'</span>, <span class="hljs-string">'type'</span>, <span class="hljs-string">'length'</span>) <span class="hljs-keyword">as</span> $val)
			{
				<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>($param[$val]))
				{
					$param[$val] = <span class="hljs-string">''</span>;
				}
			}

			oci_bind_by_name(<span class="hljs-keyword">$this</span>-&gt;stmt_id, $param[<span class="hljs-string">'name'</span>], $param[<span class="hljs-string">'value'</span>], $param[<span class="hljs-string">'length'</span>], $param[<span class="hljs-string">'type'</span>]);
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<div class="dox">
<div class="summary">
<p>Begin Transaction</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_trans_begin</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;commit_mode = OCI_NO_AUTO_COMMIT;
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">TRUE</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<div class="dox">
<div class="summary">
<p>Commit Transaction</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_trans_commit</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;commit_mode = OCI_COMMIT_ON_SUCCESS;

		<span class="hljs-keyword">return</span> oci_commit(<span class="hljs-keyword">$this</span>-&gt;conn_id);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<div class="dox">
<div class="summary">
<p>Rollback Transaction</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>bool
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_trans_rollback</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;commit_mode = OCI_COMMIT_ON_SUCCESS;
		<span class="hljs-keyword">return</span> oci_rollback(<span class="hljs-keyword">$this</span>-&gt;conn_id);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<div class="dox">
<div class="summary">
<p>Affected Rows</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>int
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">affected_rows</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">return</span> oci_num_rows(<span class="hljs-keyword">$this</span>-&gt;stmt_id);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<div class="dox">
<div class="summary">
<p>Insert ID</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>int
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insert_id</span><span class="hljs-params">()</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>not supported in oracle</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;display_error(<span class="hljs-string">'db_unsupported_function'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<div class="dox">
<div class="summary">
<p>Show table query</p>
</div>
<div class="body">
<p>Generates a platform-specific query string so that the table names can be fetched</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
<span>$prefix_limit
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_list_tables</span><span class="hljs-params">($prefix_limit = FALSE)</span>
	</span>{
		$sql = <span class="hljs-string">'SELECT "TABLE_NAME" FROM "ALL_TABLES"'</span>;

		<span class="hljs-keyword">if</span> ($prefix_limit !== <span class="hljs-keyword">FALSE</span> &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;dbprefix !== <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">return</span> $sql.<span class="hljs-string">' WHERE "TABLE_NAME" LIKE \''</span>.<span class="hljs-keyword">$this</span>-&gt;escape_like_str(<span class="hljs-keyword">$this</span>-&gt;dbprefix).<span class="hljs-string">"%' "</span>
				.sprintf(<span class="hljs-keyword">$this</span>-&gt;_like_escape_str, <span class="hljs-keyword">$this</span>-&gt;_like_escape_chr);
		}

		<span class="hljs-keyword">return</span> $sql;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<div class="dox">
<div class="summary">
<p>Show column query</p>
</div>
<div class="body">
<p>Generates a platform-specific query string so that the column names can be fetched</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$table
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_list_columns</span><span class="hljs-params">($table = <span class="hljs-string">''</span>)</span>
	</span>{
		<span class="hljs-keyword">if</span> (strpos($table, <span class="hljs-string">'.'</span>) !== <span class="hljs-keyword">FALSE</span>)
		{
			sscanf($table, <span class="hljs-string">'%[^.].%s'</span>, $owner, $table);
		}
		<span class="hljs-keyword">else</span>
		{
			$owner = <span class="hljs-keyword">$this</span>-&gt;username;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-string">'SELECT COLUMN_NAME FROM ALL_TAB_COLUMNS
			WHERE UPPER(OWNER) = '</span>.<span class="hljs-keyword">$this</span>-&gt;escape(strtoupper($owner)).<span class="hljs-string">'
				AND UPPER(TABLE_NAME) = '</span>.<span class="hljs-keyword">$this</span>-&gt;escape(strtoupper($table));
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns an object with field data</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$table
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>array
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">field_data</span><span class="hljs-params">($table)</span>
	</span>{
		<span class="hljs-keyword">if</span> (strpos($table, <span class="hljs-string">'.'</span>) !== <span class="hljs-keyword">FALSE</span>)
		{
			sscanf($table, <span class="hljs-string">'%[^.].%s'</span>, $owner, $table);
		}
		<span class="hljs-keyword">else</span>
		{
			$owner = <span class="hljs-keyword">$this</span>-&gt;username;
		}

		$sql = <span class="hljs-string">'SELECT COLUMN_NAME, DATA_TYPE, CHAR_LENGTH, DATA_PRECISION, DATA_LENGTH, DATA_DEFAULT, NULLABLE
			FROM ALL_TAB_COLUMNS
			WHERE UPPER(OWNER) = '</span>.<span class="hljs-keyword">$this</span>-&gt;escape(strtoupper($owner)).<span class="hljs-string">'
				AND UPPER(TABLE_NAME) = '</span>.<span class="hljs-keyword">$this</span>-&gt;escape(strtoupper($table));

		<span class="hljs-keyword">if</span> (($query = <span class="hljs-keyword">$this</span>-&gt;query($sql)) === <span class="hljs-keyword">FALSE</span>)
		{
			<span class="hljs-keyword">return</span> <span class="hljs-keyword">FALSE</span>;
		}
		$query = $query-&gt;result_object();

		$retval = <span class="hljs-keyword">array</span>();
		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count($query); $i &lt; $c; $i++)
		{
			$retval[$i]			= <span class="hljs-keyword">new</span> stdClass();
			$retval[$i]-&gt;name		= $query[$i]-&gt;COLUMN_NAME;
			$retval[$i]-&gt;type		= $query[$i]-&gt;DATA_TYPE;

			$length = ($query[$i]-&gt;CHAR_LENGTH &gt; <span class="hljs-number">0</span>)
				? $query[$i]-&gt;CHAR_LENGTH : $query[$i]-&gt;DATA_PRECISION;
			<span class="hljs-keyword">if</span> ($length === <span class="hljs-keyword">NULL</span>)
			{
				$length = $query[$i]-&gt;DATA_LENGTH;
			}
			$retval[$i]-&gt;max_length		= $length;

			$default = $query[$i]-&gt;DATA_DEFAULT;
			<span class="hljs-keyword">if</span> ($default === <span class="hljs-keyword">NULL</span> &amp;&amp; $query[$i]-&gt;NULLABLE === <span class="hljs-string">'N'</span>)
			{
				$default = <span class="hljs-string">''</span>;
			}
			$retval[$i]-&gt;default = $default;
		}

		<span class="hljs-keyword">return</span> $retval;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<div class="dox">
<div class="summary">
<p>Error</p>
</div>
<div class="body">
<p>Returns an array containing code and message of the last
database error that has occurred.</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>array
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span><span class="hljs-params">()</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>oci_error() returns an array that already contains
'code' and 'message' keys, but it can return false
if there was no error ....</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (is_resource(<span class="hljs-keyword">$this</span>-&gt;curs_id))
		{
			$error = oci_error(<span class="hljs-keyword">$this</span>-&gt;curs_id);
		}
		<span class="hljs-keyword">elseif</span> (is_resource(<span class="hljs-keyword">$this</span>-&gt;stmt_id))
		{
			$error = oci_error(<span class="hljs-keyword">$this</span>-&gt;stmt_id);
		}
		<span class="hljs-keyword">elseif</span> (is_resource(<span class="hljs-keyword">$this</span>-&gt;conn_id))
		{
			$error = oci_error(<span class="hljs-keyword">$this</span>-&gt;conn_id);
		}
		<span class="hljs-keyword">else</span>
		{
			$error = oci_error();
		}

		<span class="hljs-keyword">return</span> is_array($error)
			? $error
			: <span class="hljs-keyword">array</span>(<span class="hljs-string">'code'</span> =&gt; <span class="hljs-string">''</span>, <span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">''</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<div class="dox">
<div class="summary">
<p>Insert batch statement</p>
</div>
<div class="body">
<p>Generates a platform-specific insert string from the supplied data</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$table Table name
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$keys INSERT keys
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$values INSERT values
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_insert_batch</span><span class="hljs-params">($table, $keys, $values)</span>
	</span>{
		$keys = implode(<span class="hljs-string">', '</span>, $keys);
		$sql = <span class="hljs-string">"INSERT ALL\n"</span>;

		<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">0</span>, $c = count($values); $i &lt; $c; $i++)
		{
			$sql .= <span class="hljs-string">'	INTO '</span>.$table.<span class="hljs-string">' ('</span>.$keys.<span class="hljs-string">') VALUES '</span>.$values[$i].<span class="hljs-string">"\n"</span>;
		}

		<span class="hljs-keyword">return</span> $sql.<span class="hljs-string">'SELECT * FROM dual'</span>;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<div class="dox">
<div class="summary">
<p>Truncate statement</p>
</div>
<div class="body">
<p>Generates a platform-specific truncate string from the supplied data</p>
<p>If the database does not support the TRUNCATE statement,
then this method maps to 'DELETE FROM table'</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$table
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_truncate</span><span class="hljs-params">($table)</span>
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-string">'TRUNCATE TABLE '</span>.$table;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<div class="dox">
<div class="summary">
<p>Delete statement</p>
</div>
<div class="body">
<p>Generates a platform-specific delete string from the supplied data</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$table
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_delete</span><span class="hljs-params">($table)</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;qb_limit)
		{
			<span class="hljs-keyword">$this</span>-&gt;where(<span class="hljs-string">'rownum &lt;= '</span>,<span class="hljs-keyword">$this</span>-&gt;qb_limit, <span class="hljs-keyword">FALSE</span>);
			<span class="hljs-keyword">$this</span>-&gt;qb_limit = <span class="hljs-keyword">FALSE</span>;
		}

		<span class="hljs-keyword">return</span> <span class="hljs-keyword">parent</span>::_delete($table);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<div class="dox">
<div class="summary">
<p>LIMIT</p>
</div>
<div class="body">
<p>Generates a platform-specific LIMIT clause</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$sql SQL Query
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_limit</span><span class="hljs-params">($sql)</span>
	</span>{
		<span class="hljs-keyword">if</span> (version_compare(<span class="hljs-keyword">$this</span>-&gt;version(), <span class="hljs-string">'12.1'</span>, <span class="hljs-string">'&gt;='</span>))
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>OFFSET-FETCH can be used only with the ORDER BY clause</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;qb_orderby) &amp;&amp; $sql .= <span class="hljs-string">' ORDER BY 1'</span>;

			<span class="hljs-keyword">return</span> $sql.<span class="hljs-string">' OFFSET '</span>.(int) <span class="hljs-keyword">$this</span>-&gt;qb_offset.<span class="hljs-string">' ROWS FETCH NEXT '</span>.<span class="hljs-keyword">$this</span>-&gt;qb_limit.<span class="hljs-string">' ROWS ONLY'</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;limit_used = <span class="hljs-keyword">TRUE</span>;
		<span class="hljs-keyword">return</span> <span class="hljs-string">'SELECT * FROM (SELECT inner_query.*, rownum rnum FROM ('</span>.$sql.<span class="hljs-string">') inner_query WHERE rownum &lt; '</span>.(<span class="hljs-keyword">$this</span>-&gt;qb_offset + <span class="hljs-keyword">$this</span>-&gt;qb_limit + <span class="hljs-number">1</span>).<span class="hljs-string">')'</span>
			.(<span class="hljs-keyword">$this</span>-&gt;qb_offset ? <span class="hljs-string">' WHERE rnum &gt;= '</span>.(<span class="hljs-keyword">$this</span>-&gt;qb_offset + <span class="hljs-number">1</span>) : <span class="hljs-string">''</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<div class="dox">
<div class="summary">
<p>Close DB Connection</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_close</span><span class="hljs-params">()</span>
	</span>{
		oci_close(<span class="hljs-keyword">$this</span>-&gt;conn_id);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<div class="dox">
<div class="summary">
<p>We need to reset our $limit_used hack flag, so it doesn't propagate
to subsequent queries.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_reset_select</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;limit_used = <span class="hljs-keyword">FALSE</span>;
		<span class="hljs-keyword">parent</span>::_reset_select();
	}
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>

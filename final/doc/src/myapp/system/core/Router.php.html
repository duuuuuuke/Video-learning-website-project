<!DOCTYPE html>
<html>
<head>
  <title>Router.php</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "src\\myapp\\system\\core\\Router.php";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>Router.php</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-meta">&lt;?php</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>CodeIgniter</p>
</div>
<div class="body">
<p>An open source application development framework for PHP</p>
<p>This content is released under the MIT License (MIT)</p>
<p>Copyright (c) 2014 - 2019, British Columbia Institute of Technology</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">defined(<span class="hljs-string">'BASEPATH'</span>) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">exit</span>(<span class="hljs-string">'No direct script access allowed'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Router Class</p>
</div>
<div class="body">
<p>Parses URIs and determines routing</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CI_Router</span> </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>CI_Config class object</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $config;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>List of routes</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $routes =	<span class="hljs-keyword">array</span>();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Current class name</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $class =		<span class="hljs-string">''</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Current method name</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $method =	<span class="hljs-string">'index'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Sub-directory that contains the requested controller class</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $directory;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Default controller (and method if specific)</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $default_controller;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Translate URI dashes</p>
</div>
<div class="body">
<p>Determines whether dashes in controller &amp; method segments
should be automatically replaced by underscores.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $translate_uri_dashes = <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Enable query strings flag</p>
</div>
<div class="body">
<p>Determines whether to use GET parameters or segment URIs</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> $enable_query_strings = <span class="hljs-keyword">FALSE</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Class constructor</p>
</div>
<div class="body">
<p>Runs the route mapping function.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$routing
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($routing = NULL)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;config =&amp; load_class(<span class="hljs-string">'Config'</span>, <span class="hljs-string">'core'</span>);
		<span class="hljs-keyword">$this</span>-&gt;uri =&amp; load_class(<span class="hljs-string">'URI'</span>, <span class="hljs-string">'core'</span>);

		<span class="hljs-keyword">$this</span>-&gt;enable_query_strings = ( ! is_cli() &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;config-&gt;item(<span class="hljs-string">'enable_query_strings'</span>) === <span class="hljs-keyword">TRUE</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>If a directory override is configured, it has to be set before any dynamic routing logic</p>

        </td>
        <td class="code highlight">
          <pre class="php">		is_array($routing) &amp;&amp; <span class="hljs-keyword">isset</span>($routing[<span class="hljs-string">'directory'</span>]) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;set_directory($routing[<span class="hljs-string">'directory'</span>]);
		<span class="hljs-keyword">$this</span>-&gt;_set_routing();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Set any routing overrides that may exist in the main index file</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (is_array($routing))
		{
			<span class="hljs-keyword">empty</span>($routing[<span class="hljs-string">'controller'</span>]) <span class="hljs-keyword">OR</span> <span class="hljs-keyword">$this</span>-&gt;set_class($routing[<span class="hljs-string">'controller'</span>]);
			<span class="hljs-keyword">empty</span>($routing[<span class="hljs-string">'function'</span>])   <span class="hljs-keyword">OR</span> <span class="hljs-keyword">$this</span>-&gt;set_method($routing[<span class="hljs-string">'function'</span>]);
		}

		log_message(<span class="hljs-string">'info'</span>, <span class="hljs-string">'Router Class Initialized'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set route mapping</p>
</div>
<div class="body">
<p>Determines what should be served based on the URI request,
as well as any &quot;routes&quot; that have been set in the routing config file.</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_set_routing</span><span class="hljs-params">()</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>Load the routes.php file. It would be great if we could
skip this for enable_query_strings = TRUE, but then
default_controller would be empty ...</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (file_exists(APPPATH.<span class="hljs-string">'config/routes.php'</span>))
		{
			<span class="hljs-keyword">include</span>(APPPATH.<span class="hljs-string">'config/routes.php'</span>);
		}

		<span class="hljs-keyword">if</span> (file_exists(APPPATH.<span class="hljs-string">'config/'</span>.ENVIRONMENT.<span class="hljs-string">'/routes.php'</span>))
		{
			<span class="hljs-keyword">include</span>(APPPATH.<span class="hljs-string">'config/'</span>.ENVIRONMENT.<span class="hljs-string">'/routes.php'</span>);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Validate &amp; get reserved routes</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($route) &amp;&amp; is_array($route))
		{
			<span class="hljs-keyword">isset</span>($route[<span class="hljs-string">'default_controller'</span>]) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;default_controller = $route[<span class="hljs-string">'default_controller'</span>];
			<span class="hljs-keyword">isset</span>($route[<span class="hljs-string">'translate_uri_dashes'</span>]) &amp;&amp; <span class="hljs-keyword">$this</span>-&gt;translate_uri_dashes = $route[<span class="hljs-string">'translate_uri_dashes'</span>];
			<span class="hljs-keyword">unset</span>($route[<span class="hljs-string">'default_controller'</span>], $route[<span class="hljs-string">'translate_uri_dashes'</span>]);
			<span class="hljs-keyword">$this</span>-&gt;routes = $route;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Are query strings enabled in the config file? Normally CI doesn't utilize query strings
since URI segments are more search-engine friendly, but they can optionally be used.
If this feature is enabled, we will gather the directory/class/method a little differently</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;enable_query_strings)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>If the directory is set at this time, it means an override exists, so skip the checks</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;directory))
			{
				$_d = <span class="hljs-keyword">$this</span>-&gt;config-&gt;item(<span class="hljs-string">'directory_trigger'</span>);
				$_d = <span class="hljs-keyword">isset</span>($_GET[$_d]) ? trim($_GET[$_d], <span class="hljs-string">" \t\n\r\0\x0B/"</span>) : <span class="hljs-string">''</span>;

				<span class="hljs-keyword">if</span> ($_d !== <span class="hljs-string">''</span>)
				{
					<span class="hljs-keyword">$this</span>-&gt;uri-&gt;filter_uri($_d);
					<span class="hljs-keyword">$this</span>-&gt;set_directory($_d);
				}
			}

			$_c = trim(<span class="hljs-keyword">$this</span>-&gt;config-&gt;item(<span class="hljs-string">'controller_trigger'</span>));
			<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>($_GET[$_c]))
			{
				<span class="hljs-keyword">$this</span>-&gt;uri-&gt;filter_uri($_GET[$_c]);
				<span class="hljs-keyword">$this</span>-&gt;set_class($_GET[$_c]);

				$_f = trim(<span class="hljs-keyword">$this</span>-&gt;config-&gt;item(<span class="hljs-string">'function_trigger'</span>));
				<span class="hljs-keyword">if</span> ( ! <span class="hljs-keyword">empty</span>($_GET[$_f]))
				{
					<span class="hljs-keyword">$this</span>-&gt;uri-&gt;filter_uri($_GET[$_f]);
					<span class="hljs-keyword">$this</span>-&gt;set_method($_GET[$_f]);
				}

				<span class="hljs-keyword">$this</span>-&gt;uri-&gt;rsegments = <span class="hljs-keyword">array</span>(
					<span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;class,
					<span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;method
				);
			}
			<span class="hljs-keyword">else</span>
			{
				<span class="hljs-keyword">$this</span>-&gt;_set_default_controller();
			}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Routing rules don't apply to query strings and we don't need to detect
directories, so we're done here</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">return</span>;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Is there anything to parse?</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;uri-&gt;uri_string !== <span class="hljs-string">''</span>)
		{
			<span class="hljs-keyword">$this</span>-&gt;_parse_routes();
		}
		<span class="hljs-keyword">else</span>
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_default_controller();
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set request route</p>
</div>
<div class="body">
<p>Takes an array of URI segments as input and sets the class/method
to be called.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$segments URI segments
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_set_request</span><span class="hljs-params">($segments = array<span class="hljs-params">()</span>)</span>
	</span>{
		$segments = <span class="hljs-keyword">$this</span>-&gt;_validate_request($segments);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>If we don't have any segments left - try the default controller;
WARNING: Directories get shifted out of the segments array!</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>($segments))
		{
			<span class="hljs-keyword">$this</span>-&gt;_set_default_controller();
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">$this</span>-&gt;translate_uri_dashes === <span class="hljs-keyword">TRUE</span>)
		{
			$segments[<span class="hljs-number">0</span>] = str_replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">'_'</span>, $segments[<span class="hljs-number">0</span>]);
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($segments[<span class="hljs-number">1</span>]))
			{
				$segments[<span class="hljs-number">1</span>] = str_replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">'_'</span>, $segments[<span class="hljs-number">1</span>]);
			}
		}

		<span class="hljs-keyword">$this</span>-&gt;set_class($segments[<span class="hljs-number">0</span>]);
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($segments[<span class="hljs-number">1</span>]))
		{
			<span class="hljs-keyword">$this</span>-&gt;set_method($segments[<span class="hljs-number">1</span>]);
		}
		<span class="hljs-keyword">else</span>
		{
			$segments[<span class="hljs-number">1</span>] = <span class="hljs-string">'index'</span>;
		}

		array_unshift($segments, <span class="hljs-keyword">NULL</span>);
		<span class="hljs-keyword">unset</span>($segments[<span class="hljs-number">0</span>]);
		<span class="hljs-keyword">$this</span>-&gt;uri-&gt;rsegments = $segments;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set default controller</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_set_default_controller</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;default_controller))
		{
			show_error(<span class="hljs-string">'Unable to determine what should be displayed. A default route has not been specified in the routing file.'</span>);
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Is the method being specified?</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">if</span> (sscanf(<span class="hljs-keyword">$this</span>-&gt;default_controller, <span class="hljs-string">'%[^/]/%s'</span>, $class, $method) !== <span class="hljs-number">2</span>)
		{
			$method = <span class="hljs-string">'index'</span>;
		}

		<span class="hljs-keyword">if</span> ( ! file_exists(APPPATH.<span class="hljs-string">'controllers/'</span>.<span class="hljs-keyword">$this</span>-&gt;directory.ucfirst($class).<span class="hljs-string">'.php'</span>))
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>This will trigger 404 later</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">$this</span>-&gt;set_class($class);
		<span class="hljs-keyword">$this</span>-&gt;set_method($method);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Assign routed segments, index starting from 1</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">$this</span>-&gt;uri-&gt;rsegments = <span class="hljs-keyword">array</span>(
			<span class="hljs-number">1</span> =&gt; $class,
			<span class="hljs-number">2</span> =&gt; $method
		);

		log_message(<span class="hljs-string">'debug'</span>, <span class="hljs-string">'No URI present. Default controller set.'</span>);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<div class="dox">
<div class="summary">
<p>Validate request</p>
</div>
<div class="body">
<p>Attempts validate the URI request and determine the controller path.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">array</span>
<span>$segments URI segments
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>mixed URI segments
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_validate_request</span><span class="hljs-params">($segments)</span>
	</span>{
		$c = count($segments);
		$directory_override = <span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;directory);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Loop through our segments and return as soon as a controller
is found or when such a directory doesn't exist</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">while</span> ($c-- &gt; <span class="hljs-number">0</span>)
		{
			$test = <span class="hljs-keyword">$this</span>-&gt;directory
				.ucfirst(<span class="hljs-keyword">$this</span>-&gt;translate_uri_dashes === <span class="hljs-keyword">TRUE</span> ? str_replace(<span class="hljs-string">'-'</span>, <span class="hljs-string">'_'</span>, $segments[<span class="hljs-number">0</span>]) : $segments[<span class="hljs-number">0</span>]);

			<span class="hljs-keyword">if</span> ( ! file_exists(APPPATH.<span class="hljs-string">'controllers/'</span>.$test.<span class="hljs-string">'.php'</span>)
				&amp;&amp; $directory_override === <span class="hljs-keyword">FALSE</span>
				&amp;&amp; is_dir(APPPATH.<span class="hljs-string">'controllers/'</span>.<span class="hljs-keyword">$this</span>-&gt;directory.$segments[<span class="hljs-number">0</span>])
			)
			{
				<span class="hljs-keyword">$this</span>-&gt;set_directory(array_shift($segments), <span class="hljs-keyword">TRUE</span>);
				<span class="hljs-keyword">continue</span>;
			}

			<span class="hljs-keyword">return</span> $segments;
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>This means that all segments were actually directories</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">return</span> $segments;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<div class="dox">
<div class="summary">
<p>Parse Routes</p>
</div>
<div class="body">
<p>Matches any routes that may exist in the config/routes.php file
against the URI to determine if the class/method need to be remapped.</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">protected</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_parse_routes</span><span class="hljs-params">()</span>
	</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>Turn the segment array into a URI string</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$uri = implode(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">$this</span>-&gt;uri-&gt;segments);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>Get HTTP verb</p>

        </td>
        <td class="code highlight">
          <pre class="php">		$http_verb = <span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">'REQUEST_METHOD'</span>]) ? strtolower($_SERVER[<span class="hljs-string">'REQUEST_METHOD'</span>]) : <span class="hljs-string">'cli'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>Loop through the route array looking for wildcards</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">$this</span>-&gt;routes <span class="hljs-keyword">as</span> $key =&gt; $val)
		{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Check if route format is using HTTP verbs</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> (is_array($val))
			{
				$val = array_change_key_case($val, CASE_LOWER);
				<span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($val[$http_verb]))
				{
					$val = $val[$http_verb];
				}
				<span class="hljs-keyword">else</span>
				{
					<span class="hljs-keyword">continue</span>;
				}
			}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>Convert wildcards to RegEx</p>

        </td>
        <td class="code highlight">
          <pre class="php">			$key = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">':any'</span>, <span class="hljs-string">':num'</span>), <span class="hljs-keyword">array</span>(<span class="hljs-string">'[^/]+'</span>, <span class="hljs-string">'[0-9]+'</span>), $key);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Does the RegEx match?</p>

        </td>
        <td class="code highlight">
          <pre class="php">			<span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'#^'</span>.$key.<span class="hljs-string">'$#'</span>, $uri, $matches))
			{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>Are we using callbacks to process back-references?</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">if</span> ( ! is_string($val) &amp;&amp; is_callable($val))
				{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>Remove the original string from the matches array.</p>

        </td>
        <td class="code highlight">
          <pre class="php">					array_shift($matches);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>Execute the callback using the values in matches as its parameters.</p>

        </td>
        <td class="code highlight">
          <pre class="php">					$val = call_user_func_array($val, $matches);
				}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>Are we using the default routing method for back-references?</p>

        </td>
        <td class="code highlight">
          <pre class="php">				<span class="hljs-keyword">elseif</span> (strpos($val, <span class="hljs-string">'$'</span>) !== <span class="hljs-keyword">FALSE</span> &amp;&amp; strpos($key, <span class="hljs-string">'('</span>) !== <span class="hljs-keyword">FALSE</span>)
				{
					$val = preg_replace(<span class="hljs-string">'#^'</span>.$key.<span class="hljs-string">'$#'</span>, $val, $uri);
				}

				<span class="hljs-keyword">$this</span>-&gt;_set_request(explode(<span class="hljs-string">'/'</span>, $val));
				<span class="hljs-keyword">return</span>;
			}
		}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>If we got this far it means we didn't encounter a
matching route so we'll set the site default route</p>

        </td>
        <td class="code highlight">
          <pre class="php">		<span class="hljs-keyword">$this</span>-&gt;_set_request(array_values(<span class="hljs-keyword">$this</span>-&gt;uri-&gt;segments));
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set class name</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$class Class name
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_class</span><span class="hljs-params">($class)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;class = str_replace(<span class="hljs-keyword">array</span>(<span class="hljs-string">'/'</span>, <span class="hljs-string">'.'</span>), <span class="hljs-string">''</span>, $class);
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<div class="dox">
<div class="summary">
<p>Fetch the current class</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetch_class</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;class;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set method name</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$method Method name
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_method</span><span class="hljs-params">($method)</span>
	</span>{
		<span class="hljs-keyword">$this</span>-&gt;method = $method;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<div class="dox">
<div class="summary">
<p>Fetch the current method</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetch_method</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;method;
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set directory name</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">string</span>
<span>$dir Directory name
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">bool</span>
<span>$append Whether we're appending rather than setting the full value
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>void
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set_directory</span><span class="hljs-params">($dir, $append = FALSE)</span>
	</span>{
		<span class="hljs-keyword">if</span> ($append !== <span class="hljs-keyword">TRUE</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">empty</span>(<span class="hljs-keyword">$this</span>-&gt;directory))
		{
			<span class="hljs-keyword">$this</span>-&gt;directory = str_replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">''</span>, trim($dir, <span class="hljs-string">'/'</span>)).<span class="hljs-string">'/'</span>;
		}
		<span class="hljs-keyword">else</span>
		{
			<span class="hljs-keyword">$this</span>-&gt;directory .= str_replace(<span class="hljs-string">'.'</span>, <span class="hljs-string">''</span>, trim($dir, <span class="hljs-string">'/'</span>)).<span class="hljs-string">'/'</span>;
		}
	}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<hr>

        </td>
        <td class="code highlight">
          <pre class="php">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<div class="dox">
<div class="summary">
<p>Fetch directory</p>
</div>
<div class="body">
<p>Feches the sub-directory (if any) that contains the requested
controller class.</p>
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>string
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="php">	<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetch_directory</span><span class="hljs-params">()</span>
	</span>{
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;directory;
	}

}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
